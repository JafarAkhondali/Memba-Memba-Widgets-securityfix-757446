<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Add test to query string</title>
    <script>
        window.app = { DEBUG: true };
    </script>
    <link href="../../vendor/mocha.css" rel="stylesheet" />
    <!-- SystemJS loader -->
    <script src="../../vendor/polyfill.min.js"></script>
    <script src="../../vendor/system.js"></script>
    <script>
        (function () {
            'use strict';
            SystemJS.config({
                baseURL: '../../../',
                map: {
                    'jquery': 'src/js/vendor/jquery/jquery-3.3.1.js',
                    // Kendo UI - http://docs.telerik.com/kendo-ui/third-party/systemjs
                    'kendo.binder': 'src/js/vendor/kendo/kendo.binder.js',
                    'kendo.core': 'src/js/vendor/kendo/kendo.core.js',
                    'kendo.data': 'src/js/vendor/kendo/kendo.data.js',
                    'kendo.data.odata': 'src/js/vendor/kendo/kendo.data.odata.js',
                    'kendo.data.xml': 'src/js/vendor/kendo/kendo.data.xml.js',
                    // Test frameworks
                    'chai': 'test/vendor/chai.js',
                    'chai-jquery': 'test/vendor/chai-jquery.js',
                    'jquery.mockjax': 'test/vendor/jquery.mockjax.js',
                    'jquery.simulate': 'test/vendor/jquery.simulate.js',
                    'jscheck': 'test/vendor/jscheck.js',
                    'mocha': 'test/vendor/mocha.js',
                    'sinon': 'test/vendor/sinon.js',
                    'sinon-chai': 'test/vendor/sinon-chai.js'
                },
                meta: {
                    'test/vendor/chai-jquery.js': { format: 'cjs' },
                    'test/vendor/jquery.mockjax.js': { format: 'global' },
                    'test/vendor/jscheck.js': { format: 'global' },
                    'test/vendor/mocha.js': { format: 'global' },
                    'test/vendor/sinon-chai.js': { format: 'cjs' }
                },
                packages: {
                    'src/js': {
                        defaultExtension: 'js',
                        meta: {
                            '*.js': {
                                babelOptions: {
                                    es2015: false,
                                    stage2: false,
                                    stage3: false
                                },
                                format: 'amd'
                            },
                            '*.es6': {
                                format: 'esm'
                            }
                        }
                    }
                },
                paths: {
                    'plugin-babel': 'node_modules/systemjs-plugin-babel/plugin-babel.js',
                    'systemjs-babel-build': 'node_modules/systemjs-plugin-babel/systemjs-babel-browser.js'
                },
                transpiler: 'plugin-babel'
            });
            SystemJS.import('mocha').then(function (args) {
                var mocha = args.mocha;
                // Help SystemJS export mocha globals
                // https://staxmanade.com/2015/09/browser-only-mochajs-tests-using-systemjs/
                mocha.suite.on('pre-require', function (context) {
                    var exports = window;
                    exports.afterEach = context.afterEach || context.teardown;
                    exports.after = context.after || context.suiteTeardown;
                    exports.beforeEach = context.beforeEach || context.setup;
                    exports.before = context.before || context.suiteSetup;
                    exports.describe = context.describe || context.suite;
                    exports.it = context.it || context.test;
                    exports.setup = context.setup || context.beforeEach;
                    exports.suiteSetup = context.suiteSetup || context.before;
                    exports.suiteTeardown = context.suiteTeardown || context.after;
                    exports.suite = context.suite || context.describe;
                    exports.teardown = context.teardown || context.afterEach;
                    exports.test = context.test || context.it;
                    exports.run = context.run;
                    const params = new URLSearchParams(window.location.search);
                    const test = params.get('t');
                    if (test) {
                        document.title = test;
                        document.getElementsByTagName('h1')[0].innerHTML = test;
                        document.getElementById('menu').style.display = 'none';
                        // now use SystemJS to load all test files
                        SystemJS.import('./' + test + '.test.es6').then(function() {
                            mocha.checkLeaks().globals([]);
                            // if (!window.blanket && !window.PHANTOMJS) {
                            mocha.run();
                            // }
                        });
                    }
                });
                mocha.setup('bdd');
                mocha.timeout(10000);
            });
        }());
    </script>
</head>
<body>
<h1>Add test to query string ?t=[name] (from name.test.es6)</h1>
<ul id="menu">
    <li><a href="?t=data.util">data.util</a><span style="color:red;">*</span></li>
    <li><a href="?t=datasources.base">datasources.base</a><span style="color:red;">*</span></li>
    <li><a href="?t=models.base">models.base</a><span style="color:red;">*</span></li>
    <li><a href="?t=models.page">models.page</a><span style="color:red;">*</span></li>
    <li><a href="?t=models.pagecomponent">models.pagecomponent</a><span style="color:red;">*</span></li>
    <li><a href="?t=models.stream">models.stream</a><span style="color:red;">*</span></li>
</ul>
<div id="mocha"></div>
<div id="fixtures"></div>
</body>
</html>
