<!DOCTYPE html>
<html>
<head>
    <title>kidoju.widgets.stage</title>
    <script>
        window.app = { DEBUG: true };
    </script>
    <link href="./styles/vendor/kendo/web/kendo.common.min.css" rel="stylesheet">
    <link href="./styles/vendor/kendo/web/kendo.default.min.css" rel="stylesheet">
    <link href="./styles/vendor/kendo/web/kendo.default.mobile.min.css" rel="stylesheet">
    <script src="./js/vendor/kendo/jquery.min.js"></script>
    <script src="./js/vendor/kendo/kendo.all.min.js"></script>
    <!--script src="./js/vendor/kendo/kendo.core.js"></script>
    <script src="./js/vendor/kendo/kendo.data.js"></script>
    <script src="./js/vendor/kendo/kendo.binder.js"></script-->
    <!-- Stage requirements -->
    <link href="./styles/kidoju.widgets.stage.css" rel="stylesheet">
    <link href="./styles/kidoju.widgets.toolbox.css" rel="stylesheet">
    <link href="./styles/kidoju.widgets.mediaplayer.css" rel="stylesheet">
    <script src="./js/window.assert.js"></script>
    <script src="./js/window.log.js"></script>
    <script src="./js/kidoju.data.js"></script>
    <script src="./js/kidoju.tools.js"></script>
    <script src="./js/kidoju.widgets.mediaplayer.js"></script>
    <script src="./js/kidoju.widgets.toolbox.js"></script>
    <script src="./js/kidoju.widgets.stage.js"></script>
    <style>
        body {background-color:darkgrey;}
    </style>
</head>
<body>
<div>
    <input id="slider" value="100" />
    <input id="design" type="radio" name="mode" value="design" checked=true /><label for="design">design</label>
    <input id="play" type="radio" name="mode" value="play" /><label for="play">play</label>
    <input id="review" type="radio" name="mode" value="thumbnail" /><label for="review">review</label>
    <input id="enabled" type="checkbox" checked /><label for="enabled">enabled</label>
    <input id="readonly" type="checkbox" /><label for="readonly">readonly</label>
</div>
<div id="toolbox"></div>
<div id="stage"></div>
<div id="grid"></div>
</body>
<script>
    ;(function(window, $, undefined){

        'use strict';

        var kendo = window.kendo,
            kidoju = window.kidoju,
            PageComponentCollectionDataSource = kidoju.data.PageComponentCollectionDataSource;

        var pageComponentCollectionDataSource = new PageComponentCollectionDataSource({
            data: [
                { id: kendo.guid(), tool : 'image', top: 50, left: 100, height: 250, width: 250, rotate: 45, attributes: { src: 'http://marketingland.com/wp-content/ml-loads/2013/04/google-g-logo-2012.png' } },
                { id: kendo.guid(), tool : 'image', top: 300, left: 300, height: 250, width: 250, rotate: 315, attributes: { src: 'http://4.bp.blogspot.com/_cPxcXn8pqkM/TCoCrLc7mVI/AAAAAAAABF0/8d6paccQU8A/s320/228_facebook.jpg' } },
                { id: kendo.guid(), tool : 'label', top: 250, left: 500, height: 100, width: 300, rotate: 90, attributes: { style: 'font-family: Georgia, serif; color: #FF0000;', text: 'World' } },
                { id: kendo.guid(), tool : 'textbox', top: 20, left: 20, height: 100, width: 300, rotate: 0, attributes: {}, properties: { name: 'textfield3' } }
            ]
        });

        $(document).ready(function() {

            var stage = $('#stage').kendoStage({
                dataSource: pageComponentCollectionDataSource,
                autoBind: false,
                mode: 'design',
                select: function(e) {
                    var grid = $('#grid').data('kendoGrid');
                    if(e.value) {
                        var uid = grid.dataSource.get(e.value.id).uid,
                            rows = grid.table.find('tr[data-uid="' + uid + '"]');
                        if (!rows.hasClass('k-state-selected')) {
                            grid.select(rows);
                        }
                    } else {
                        grid.clearSelection();
                    }
                }
            }).data('kendoStage');

            $('#grid').kendoGrid({
                dataSource: pageComponentCollectionDataSource,
                autoBind: false,
                height: 300,
                selectable: true,
                editable: true,
                columns: [
                    {
                        field: "id",
                        title: "Id",
                        width: 320
                    },
                    {
                        field: "tool",
                        title: "Tool",
                        width: 100
                    },
                    {
                        field: "top",
                        title: "Top",
                        width: 60
                    },
                    {
                        field: "left",
                        title: "Left",
                        width: 60
                    },
                    {
                        field: "height",
                        title: "Hei.",
                        width: 60
                    },
                    {
                        field: "width",
                        title: "Wid.",
                        width: 60
                    },
                    {
                        field: "rotate",
                        title: "Rot.",
                        width: 60
                    },
                    //tag
                    {
                        field: "attributes",
                        title: "Attributes"
                    },
                    {
                        field: "properties",
                        title: "Properties"
                    },
                    {
                        command: "destroy",
                        title: "&nbsp;",
                        width: 120
                    }
                ],
                change: function(e) {
                    var rows = this.select(),
                        item = this.dataItem(rows[0]);
                    if(item && item.id) {
                        stage._selectByUid(item.uid);
                    }
                }
            });

            $('#slider').kendoSlider({
                increaseButtonTitle: 'Zoom in',
                decreaseButtonTitle: 'Zoom out',
                min: 0,
                max: 100,
                smallStep: 1,
                largeStep: 10,
                change: function(e) {
                    stage.scale(e.value/100);
                }
            });

            $('#toolbox').kendoToolBox();

            $('input[name=mode]').on('change', function(e) {
                switch(e.currentTarget.value) {
                    case "design":
                        stage.mode(kendo.ui.Stage.fn.modes.design);
                        break;
                    case "play":
                        stage.mode(kendo.ui.Stage.fn.modes.play);
                        break;
                    case "thumbnail":
                        stage.mode(kendo.ui.Stage.fn.modes.thumbnail);
                        break;
                }
            });

            //Note: we have autoBind = false
            pageComponentCollectionDataSource.read();

        });

    }(this, jQuery));
</script>
</html>
