<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>kidoju.widgets.selector</title>
    <script>
        window.app = { DEBUG: true };
    </script>
    <link href="./styles/vendor/kendo/web/kendo.common.min.css" rel="stylesheet">
    <link href="./styles/vendor/kendo/web/kendo.default.min.css" rel="stylesheet">
    <link href="./styles/vendor/kendo/web/kendo.default.mobile.min.css" rel="stylesheet">
    <!-- kidoju.widgets.selector stylesheet -->
    <!--link href="./styles/kidoju.widgets.selector.css" rel="stylesheet"-->
    <!-- SystemJS loader -->
    <script src="../test/vendor/system.js"></script>
    <script>
        (function () {
            'use strict';
            SystemJS.config({
                baseURL: './',
                bundles: {
                    'kendogrid': ['kendo.grid'],
                    'kendoaspnetmvc': ['kendo.aspnetmvc'],
                    'kendodatavizbarcode': ['kendo.dataviz.barcode'],
                    'kendodatavizchart': ['kendo.dataviz.chart'],
                    'kendodatavizcore': ['kendo.dataviz.core'],
                    'kendodatavizdiagram': ['kendo.dataviz.diagram'],
                    'kendodatavizgauge': ['kendo.dataviz.gauge'],
                    'kendodatavizmap': ['kendo.dataviz.map'],
                    'kendodatavizqrcode': ['kendo.dataviz.qrcode'],
                    'kendodatavizsparkline': ['kendo.dataviz.sparkline'],
                    'kendodatavizstock': ['kendo.dataviz.stock'],
                    'kendodatavizthemes': ['kendo.dataviz.themes'],
                    'kendodataviztreemap': ['kendo.dataviz.treemap'],
                    'kendodrawing': ['kendo.drawing'],
                    'kendoeditor': ['kendo.editor'],
                    'kendogantt': ['kendo.gantt'],
                    'kendopdf': ['kendo.pdf'],
                    'kendoscheduler': ['kendo.scheduler'],
                    'kendospreadsheet': ['kendo.spreadsheet']
                },
                map: {
                    'jquery': 'js/vendor/jquery/jquery-3.3.1.js',
                    // http://docs.telerik.com/kendo-ui/third-party/systemjs
                    'kendo.culture.en-GB': 'js/vendor/kendo/cultures/kendo.culture.en-GB.js',
                    'kendo.messages.en-GB': 'js/vendor/kendo/messages/kendo.messages.en-GB.js',
                    'kendo.autocomplete': 'js/vendor/kendo/kendo.autocomplete.js',
                    'kendo.binder': 'js/vendor/kendo/kendo.binder.js',
                    'kendo.button': 'js/vendor/kendo/kendo.button.js',
                    'kendo.calendar': 'js/vendor/kendo/kendo.calendar.js',
                    'kendo.color': 'js/vendor/kendo/kendo.color.js',
                    'kendo.colorpicker': 'js/vendor/kendo/kendo.colorpicker.js',
                    'kendo.columnmenu': 'js/vendor/kendo/kendo.columnmenu.js',
                    'kendo.columnsorter': 'js/vendor/kendo/kendo.columnsorter.js',
                    'kendo.combobox': 'js/vendor/kendo/kendo.combobox.js',
                    'kendo.core': 'js/vendor/kendo/kendo.core.js',
                    'kendo.data': 'js/vendor/kendo/kendo.data.js',
                    'kendo.data.odata': 'js/vendor/kendo/kendo.data.odata.js',
                    'kendo.data.signalr': 'js/vendor/kendo/kendo.data.signalr.js',
                    'kendo.data.xml': 'js/vendor/kendo/kendo.data.xml.js',
                    'kendo.dateinput': 'js/vendor/kendo/kendo.dateinput.js',
                    'kendo.datepicker': 'js/vendor/kendo/kendo.datepicker.js',
                    'kendo.datetimepicker': 'js/vendor/kendo/kendo.datetimepicker.js',
                    'kendo.dialog': 'js/vendor/kendo/kendo.dialog.js',
                    'kendo.dom': 'js/vendor/kendo/kendo.dom.js',
                    'kendo.draganddrop': 'js/vendor/kendo/kendo.draganddrop.js',
                    'kendo.dropdownlist': 'js/vendor/kendo/kendo.dropdownlist.js',
                    'kendo.editable': 'js/vendor/kendo/kendo.editable.js',
                    'kendo.excel': 'js/vendor/kendo/kendo.excel.js',
                    'kendo.filebrowser': 'js/vendor/kendo/kendo.filebrowser.js',
                    'kendo.filtercell': 'js/vendor/kendo/kendo.filtercell.js',
                    'kendo.filtermenu': 'js/vendor/kendo/kendo.filtermenu.js',
                    'kendo.fx': 'js/vendor/kendo/kendo.fx.js',
                    'kendo.gantt.list': 'js/vendor/kendo/kendo.gantt.list.js',
                    'kendo.gantt.timeline': 'js/vendor/kendo/kendo.gantt.timeline.js',
                    'kendo.groupable': 'js/vendor/kendo/kendo.groupable.js',
                    'kendo.imagebrowser': 'js/vendor/kendo/kendo.imagebrowser.js',
                    'kendo.list': 'js/vendor/kendo/kendo.list.js',
                    'kendo.listview': 'js/vendor/kendo/kendo.listview.js',
                    'kendo.maskedtextbox': 'js/vendor/kendo/kendo.maskedtextbox.js',
                    'kendo.mediaplayer': 'js/vendor/kendo/kendo.mediaplayer.js',
                    'kendo.menu': 'js/vendor/kendo/kendo.menu.js',
                    'kendo.mobile.actionsheet': 'js/vendor/kendo/kendo.mobile.actionsheet.js',
                    'kendo.mobile.application': 'js/vendor/kendo/kendo.mobile.application.js',
                    'kendo.mobile.button': 'js/vendor/kendo/kendo.mobile.button.js',
                    'kendo.mobile.buttongroup': 'js/vendor/kendo/kendo.mobile.buttongroup.js',
                    'kendo.mobile.collapsible': 'js/vendor/kendo/kendo.mobile.collapsible.js',
                    'kendo.mobile.drawer': 'js/vendor/kendo/kendo.mobile.drawer.js',
                    'kendo.mobile.listview': 'js/vendor/kendo/kendo.mobile.listview.js',
                    'kendo.mobile.loader': 'js/vendor/kendo/kendo.mobile.loader.js',
                    'kendo.mobile.modalview': 'js/vendor/kendo/kendo.mobile.modalview.js',
                    'kendo.mobile.navbar': 'js/vendor/kendo/kendo.mobile.navbar.js',
                    'kendo.mobile.pane': 'js/vendor/kendo/kendo.mobile.pane.js',
                    'kendo.mobile.popover': 'js/vendor/kendo/kendo.mobile.popover.js',
                    'kendo.mobile.scroller': 'js/vendor/kendo/kendo.mobile.scroller.js',
                    'kendo.mobile.scrollview': 'js/vendor/kendo/kendo.mobile.scrollview.js',
                    'kendo.mobile.shim': 'js/vendor/kendo/kendo.mobile.shim.js',
                    'kendo.mobile.splitview': 'js/vendor/kendo/kendo.mobile.splitview.js',
                    'kendo.mobile.switch': 'js/vendor/kendo/kendo.mobile.switch.js',
                    'kendo.mobile.tabstrip': 'js/vendor/kendo/kendo.mobile.tabstrip.js',
                    'kendo.mobile.view': 'js/vendor/kendo/kendo.mobile.view.js',
                    'kendo.multiselect': 'js/vendor/kendo/kendo.multiselect.js',
                    'kendo.notification': 'js/vendor/kendo/kendo.notification.js',
                    'kendo.numerictextbox': 'js/vendor/kendo/kendo.numerictextbox.js',
                    'kendo.ooxml': 'js/vendor/kendo/kendo.ooxml.js',
                    'kendo.pager': 'js/vendor/kendo/kendo.pager.js',
                    'kendo.panelbar': 'js/vendor/kendo/kendo.panelbar.js',
                    'kendo.pivot.configurator': 'js/vendor/kendo/kendo.pivot.configurator.js',
                    'kendo.pivot.fieldmenu': 'js/vendor/kendo/kendo.pivot.fieldmenu.js',
                    'kendo.pivotgrid': 'js/vendor/kendo/kendo.pivotgrid.js',
                    'kendo.popup': 'js/vendor/kendo/kendo.popup.js',
                    'kendo.progressbar': 'js/vendor/kendo/kendo.progressbar.js',
                    'kendo.reorderable': 'js/vendor/kendo/kendo.reorderable.js',
                    'kendo.resizable': 'js/vendor/kendo/kendo.resizable.js',
                    'kendo.responsivepanel': 'js/vendor/kendo/kendo.responsivepanel.js',
                    'kendo.router': 'js/vendor/kendo/kendo.router.js',
                    'kendo.scheduler.agendaview': 'js/vendor/kendo/kendo.scheduler.agendaview.js',
                    'kendo.scheduler.dayview': 'js/vendor/kendo/kendo.scheduler.dayview.js',
                    'kendo.scheduler.monthview': 'js/vendor/kendo/kendo.scheduler.monthview.js',
                    'kendo.scheduler.recurrence': 'js/vendor/kendo/kendo.scheduler.recurrence.js',
                    'kendo.scheduler.timelineview': 'js/vendor/kendo/kendo.scheduler.timelineview.js',
                    'kendo.scheduler.view': 'js/vendor/kendo/kendo.scheduler.view.js',
                    'kendo.selectable': 'js/vendor/kendo/kendo.selectable.js',
                    'kendo.slider': 'js/vendor/kendo/kendo.slider.js',
                    'kendo.sortable': 'js/vendor/kendo/kendo.sortable.js',
                    'kendo.splitter': 'js/vendor/kendo/kendo.splitter.js',
                    'kendo.tabstrip': 'js/vendor/kendo/kendo.tabstrip.js',
                    'kendo.timepicker': 'js/vendor/kendo/kendo.timepicker.js',
                    'kendo.timezones': 'js/vendor/kendo/kendo.timezones.js',
                    'kendo.toolbar': 'js/vendor/kendo/kendo.toolbar.js',
                    'kendo.tooltip': 'js/vendor/kendo/kendo.tooltip.js',
                    'kendo.touch': 'js/vendor/kendo/kendo.touch.js',
                    'kendo.treelist': 'js/vendor/kendo/kendo.treelist.js',
                    'kendo.treeview.draganddrop': 'js/vendor/kendo/kendo.treeview.draganddrop.js',
                    'kendo.treeview': 'js/vendor/kendo/kendo.treeview.js',
                    'kendo.upload': 'js/vendor/kendo/kendo.upload.js',
                    'kendo.userevents': 'js/vendor/kendo/kendo.userevents.js',
                    'kendo.validator': 'js/vendor/kendo/kendo.validator.js',
                    'kendo.view': 'js/vendor/kendo/kendo.view.js',
                    'kendo.virtuallist': 'js/vendor/kendo/kendo.virtuallist.js',
                    'kendo.window': 'js/vendor/kendo/kendo.window.js',
                    'pako_deflate': 'js/vendor/kendo/pako_deflate.js',
                    'kendoaspnetmvc': 'js/vendor/kendo/kendo.aspnetmvc.js',
                    'kendodatavizbarcode': 'js/vendor/kendo/kendo.dataviz.barcode.js',
                    'kendodatavizchart': 'js/vendor/kendo/kendo.dataviz.chart.js',
                    'kendodatavizcore': 'js/vendor/kendo/kendo.dataviz.core.js',
                    'kendodatavizdiagram': 'js/vendor/kendo/kendo.dataviz.diagram.js',
                    'kendodatavizgauge': 'js/vendor/kendo/kendo.dataviz.gauge.js',
                    'kendodatavizmap': 'js/vendor/kendo/kendo.dataviz.map.js',
                    'kendodatavizqrcode': 'js/vendor/kendo/kendo.dataviz.qrcode.js',
                    'kendodatavizsparkline': 'js/vendor/kendo/kendo.dataviz.sparkline.js',
                    'kendodatavizstock': 'js/vendor/kendo/kendo.dataviz.stock.js',
                    'kendodatavizthemes': 'js/vendor/kendo/kendo.dataviz.themes.js',
                    'kendodataviztreemap': 'js/vendor/kendo/kendo.dataviz.treemap.js',
                    'kendodrawing': 'js/vendor/kendo/kendo.drawing.js',
                    'kendoeditor': 'js/vendor/kendo/kendo.editor.js',
                    'kendogantt': 'js/vendor/kendo/kendo.gantt.js',
                    'kendogrid': 'js/vendor/kendo/kendo.grid.js',
                    'kendopdf': 'js/vendor/kendo/kendo.pdf.js',
                    'kendoscheduler': 'js/vendor/kendo/kendo.scheduler.js',
                    'kendospreadsheet': 'js/vendor/kendo/kendo.spreadsheet.js'
                },
                packages: {
                    'js': {
                        defaultExtension: 'js',
                        meta: {
                            // IMPORTANT! See https://github.com/jshint/jshint/issues/2840
                            'vendor/codemirror/addon/lint/jshint.js': {
                                format: 'global'
                            },
                            '*.js': {
                                babelOptions: {
                                    es2015: false,
                                    stage2: false,
                                    stage3: false
                                },
                                format: 'amd'
                            },
                            '*.es6': {
                                format: 'esm'
                            }
                        }
                    }
                },
                paths: {
                    'plugin-babel': '../node_modules/systemjs-plugin-babel/plugin-babel.js',
                    'systemjs-babel-build': '../node_modules/systemjs-plugin-babel/systemjs-babel-browser.js'
                },
                transpiler: 'plugin-babel'
            });
            SystemJS.import('kendo.drawing') // This is a workaround to force the correct load order
                .then(function () {
                    return SystemJS.import('./js/kidoju.widgets.selector.js');
                })
                .then(function () {
                    var kendo = window.kendo;
                    function formatSelector(selector) {
                        return function () {
                            return (this.get(selector) || []).join(',');
                        };
                    }
                    function formatSource(source) {
                        return function() {
                            var ret = '';
                            var data = this.get(source);
                            if ($.isFunction(data.data)) {
                                data = data.data();
                            }
                            data.forEach(function (item) {
                                switch(item.type) {
                                    case 'selection':
                                        ret += item.id + ' ' + item.data.shape /*stroke*/ + ' ---> [';
                                        for (var i = 0, length = item.data.selections.length; i < length; i++) {
                                            ret += '[{' + item.data.selections[i].origin.join(',') + '},{' + item.data.selections[i].size.join(',') + '}]';
                                        }
                                        ret += ']\n';
                                        break;
                                    default:
                                        ret += 'Any dummy type which should not break kendo.ui.Selector\n'
                                }
                            });
                            return ret;
                        }
                    }
                    var viewModel = kendo.observable({
                        // A - Top stage
                        sourceA: [
                            // Test type filtering
                            { type: 'dummy', id: 'val_0000000', data: { a: 1, b: new Date(), c: 'foo'} },
                            // Test initial value
                            { type: 'selection', id: 'val_abcde1', data: { stroke: { color: '#00ffff', width: 6, opacity: 1, dashType: 'solid' }, shape: 'rect', selections: [{ origin: [2,12],size: [93,57]}] } }
                        ],
                        sourceA$: formatSource('sourceA'),
                        selectorA1: null,
                        selectorA1$: formatSelector('selectorA1'),
                        selectorA2: null,
                        selectorA2$: formatSelector('selectorA2'),
                        visibleA: true,
                        enabledA: true,
                        // B - Bottom stage
                        sourceB: new kendo.data.DataSource([{ type: 'dummy',  id: 'val_0000000', data: { a: 2, b: new Date(), c: 'bar'} }]),
                        sourceB$: formatSource('sourceB'),
                        selectorB1: null,
                        selectorB1$: formatSelector('selectorB1'),
                        visibleB: true,
                        enabledB: true
                    });
                    $(function() {
                        kendo.bind('body', viewModel, kendo.ui, kendo.mobile.ui);
                    });
                });
        }());
    </script>
</head>
<body>
<h1>kidoju.widgets.selector</h1>
<div id="toolbarA"></div>
<div class="kj-stage" style="position:relative;height:300px;width:300px;border:solid 1px black;transform: scale(0.75);">
    <div data-role="stage" style="height:300px;width:300px;">
        <div class="kj-element" style="position:absolute;top:10px;left:10px;height:50px;width:100px;">
            <div data-behavior="selectable" data-constant="red" style="height:50px;width:100px;background:#ff0000;border:solid 1px #000000;border-radius:50%"></div>
        </div>
        <div class="kj-element" style="position:absolute;top:10px;left:190px;height:50px;width:100px;">
            <div data-behavior="selectable" data-constant="green" style="height:50px;width:100px;background:#00ff00;border:solid 1px #000000;border-radius:50%"></div>
        </div>
        <div class="kj-element" style="position:absolute;top:240px;left:190px;height:50px;width:100px;">
            <div data-behavior="selectable" data-constant="blue" style="height:50px;width:100px;background:#0000ff;border:solid 1px #000000;border-radius:50%"></div>
        </div>
        <div class="kj-element" style="position:absolute;top:240px;left:10px;height:50px;width:100px;">
            <div data-behavior="selectable" data-constant="magenta" style="height:50px;width:100px;background:#ff00ff;border:solid 1px #000000;border-radius:50%"></div>
        </div>
        <div class="kj-element" style="position:absolute;top:125px;left:100px;height:50px;width:100px;">
            <input type="text" class="kj-interactive" style="height:50px;width:100px;font-size:40px;">
        </div>
        <div class="kj-element" style="position:absolute;top:0px;left:290px;height:10px;width:10px;">
            <div data-role="selector" data-id="val_abcde1" data-shape="rect" data-stroke="{ color: '#00FFFF', width: 6 }" data-toolbar="#toolbarA" style="height:10px;width:10px;" data-bind="value: selectorA1, source: sourceA, visible: visibleA, enabled: enabledA"></div>
        </div>
        <div class="kj-element" style="position:absolute;top:0px;left:290px;height:10px;width:10px;">
            <div data-role="selector" data-id="val_abcde2" data-shape="cross" data-stroke="{ color: '#AAFF22', width: 6 }" data-toolbar="#toolbarA" style="height:10px;width:10px;" data-bind="value: selectorA2, source: sourceA, visible: visibleA, enabled: enabledA"></div>
        </div>
    </div>
</div>
<div>
    <input type="checkbox" data-bind="checked: visibleA" />Visible&nbsp;
    <input type="checkbox" data-bind="checked: enabledA" />enabled
</div>
<pre>
{
    selectorA1: <span data-bind="text: selectorA1$"></span>
    selectorA2: <span data-bind="text: selectorA2$"></span>
    source:
    <div data-bind="text: sourceA$" style="margin-left:50px;"></div>
    visible: <span data-bind="text: visibleA"></span>
    enabled: <span data-bind="text: enabledA"></span>
}
</pre>
<!-- -------------------------------------------------------- -->
<h2>Check a second widget on the same page</h2>
<div id="toolbarB"></div>
<div class="kj-stage" style="position:relative;height:300px;width:300px;border:solid 1px black;transform: scale(0.9);">
    <div data-role="stage" style="height:300px;width:300px;">
        <div class="kj-element" style="position:absolute;top:10px;left:10px;height:50px;width:100px;">
            <div data-behavior="selectable" data-constant="red" style="height:50px;width:100px;background:#ff0000;border:solid 1px #000000;border-radius:50%"></div>
        </div>
        <div class="kj-element" style="position:absolute;top:10px;left:190px;height:50px;width:100px;">
            <div data-behavior="selectable" data-constant="green" style="height:50px;width:100px;background:#00ff00;border:solid 1px #000000;border-radius:50%"></div>
        </div>
        <div class="kj-element" style="position:absolute;top:240px;left:190px;height:50px;width:100px;">
            <div data-behavior="selectable" data-constant="blue" style="height:50px;width:100px;background:#0000ff;border:solid 1px #000000;border-radius:50%"></div>
        </div>
        <div class="kj-element" style="position:absolute;top:240px;left:10px;height:50px;width:100px;">
            <div data-behavior="selectable" data-constant="magenta" style="height:50px;width:100px;background:#ff00ff;border:solid 1px #000000;border-radius:50%"></div>
        </div>
        <div class="kj-element" style="position:absolute;top:125px;left:100px;height:50px;width:100px;">
            <div data-behavior="selectable" data-constant="cyan" style="height:50px;width:100px;background:#00ffff;border:solid 1px #000000;border-radius:50%"></div>
        </div>
        <div class="kj-element" style="position:absolute;top:0px;left:290px;height:10px;width:10px;">
            <div data-role="selector" data-id="val_abcde5" data-shape="cross" data-stroke="{ color: '#000000', width: 4 }" data-toolbar="#toolbarB" style="height:10px;width:10px;" data-bind="value: selectorB1, source: sourceB, visible: visibleB, enabled: enabledB"></div>
        </div>
    </div>
</div>
<div>
    <input type="checkbox" data-bind="checked: visibleB" />Visible&nbsp;
    <input type="checkbox" data-bind="checked: enabledB" />enabled
</div>
<pre>
{
    selectorB1: <span data-bind="text: selectorB1$"></span>
    source:
    <div data-bind="text: sourceB$" style="margin-left:50px;"></div>
    visible: <span data-bind="text: visibleB"></span>
    enabled: <span data-bind="text: enabledB"></span>
}
</pre>

</body>
</html>
