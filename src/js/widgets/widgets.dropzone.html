<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>widgets.dropzone</title>
    <script>
        window.DEBUG = true;
    </script>
    <!-- Memba fonts -->
    <link href="../../styles/fonts/memba.css" rel="stylesheet">
    <!-- Application theme -->
    <link href="../../styles/themes/app.theme.nordic.css" rel="stylesheet">
    <!-- SystemJS loader -->
    <script src="../../../test/vendor/polyfill.min.js"></script>
    <script src="../../../test/vendor/system.js"></script>
    <script src="../../js/helpers/system.config.js"></script>
    <script>
        (function () {
            'use strict';
            Promise.all([
                SystemJS.import('kendo.binder'),
                SystemJS.import('./widgets.dropzone.es6')
            ]).then(function () {
                var kendo = window.kendo;
                function formatValue(value) {
                    return function () {
                        return (this.get(value) || []).join(',');
                    };
                }
                function formatSource(source) {
                    return function () {
                        var ret = '';
                        this.get(source).forEach(function(item) {
                            ret += kendo.format('{0} {1} at ({2}, {3})\n', item.type, item.id, item.data.top, item.data.left);
                        });
                        return ret;
                    };
                }
                function formatSource(source) {
                    return function() {
                        var ret = '';
                        var data = this.get(source);
                        if ($.isFunction(data.data)) {
                            data = data.data();
                        }
                        data.forEach(function (item) {
                            switch(item.type) {
                                case 'draggable':
                                    ret += kendo.format('{0} {1} at ({2}, {3})\n', item.type, item.id, item.data.top, item.data.left);
                                    break;
                                default:
                                    ret += 'Any dummy type which should not break kendo.ui.DropZone\n'
                            }
                        });
                        return ret;
                    }
                }
                var viewModel = kendo.observable({
                    // A - Top stage
                    valueA1: null,
                    valueA1$: formatValue('valueA1'),
                    valueA2: null,
                    valueA2$: formatValue('valueA2'),
                    sourceA: [
                        { type: 'dummy', id: 'val_0000000', data: { a: 1, b: new Date(), c: 'foo'} }  // Test type filtering
                    ],
                    sourceA$: formatSource('sourceA'),
                    visibleA: true,
                    enabledA: true,
                    // B - bottom stage
                    valueB1: null,
                    valueB1$: formatValue('valueB1'),
                    sourceB: new kendo.data.DataSource([
                        { type: 'dummy',  id: 'val_0000000', data: { a: 2, b: new Date(), c: 'bar'} }  // Test type filtering
                    ]),
                    sourceB$: formatSource('sourceB'),
                    visibleB: true,
                    enabledB: true
                });
                $(function() {
                    kendo.bind('body', viewModel);
                });
            });
        }());
    </script>
    <style>
        .kj-stage {
            border: solid 1px black;
        }
    </style>
</head>
<body>
<h1>widgets.dropzone</h1>
<div class="kj-stage" style="height: 600px; width: 800px; transform: scale(0.75);">
    <div data-role="stage" style="position: relative; height: 600px; width: 800px;">
        <div class="kj-element" style="position: absolute; top: 100px; left: 150px; width: 250px; height: 250px;">
            <div class="k-header" data-role="dropzone" data-bind="value: valueA1, source: sourceA, visible: visibleA, enabled: enabledA" style="width: 250px; height: 250px;">Drag the small circles here.</div>
        </div>
        <div class="kj-element" style="position: absolute; top: 300px; left: 500px; width: 250px; height: 250px;">
            <div class="k-header" data-role="dropzone" data-center="true" data-bind="value: valueA2, source: sourceA, visible: visibleA, enabled: enabledA" style="width: 250px; height: 250px;">Or here (centered).</div>
        </div>
        <div class="kj-element" style="position: absolute; top: 50px; left: 50px; width: 50px; height: 50px;">
            <div data-behavior="draggable" data-id="draggableA1" data-constant="red" style="border: solid 1px blue; border-radius: 50%; background-color: red; width: 50px; height: 50px;"></div>
        </div>
        <div class="kj-element" style="position: absolute; top: 150px; left: 50px; width: 40px; height: 40px;">
            <div data-behavior="draggable" data-id="draggableA2" data-constant="blue" style="border: solid 1px blue; border-radius: 50%; background-color: blue; width: 40px; height: 40px;"></div>
        </div>
        <div class="kj-element" style="position: absolute; top: 250px; left: 50px; width: 30px; height: 30px;">
            <div data-behavior="draggable" data-id="draggableA3" data-constant="green" style="border: solid 1px blue; border-radius: 50%; background-color: green; width: 30px; height: 30px;"></div>
        </div>
        <div class="kj-element" style="position: absolute; top: 200px; left: 200px; width: 20px; height: 20px;">
            <div data-behavior="draggable" data-id="draggableA4" data-constant="yellow" style="border: solid 1px blue; border-radius: 50%; background-color: yellow; width: 20px; height: 20px;"></div>
        </div>
    </div>
</div>
<div>
    <input type="checkbox" data-bind="checked: visibleA" />Visible&nbsp;
    <input type="checkbox" data-bind="checked: enabledA" />Enabled&nbsp;
</div>
<pre>
{
    valueA1: <span data-bind="text: valueA1$"></span>
    valueA2: <span data-bind="text: valueA2$"></span>
    sourceA$:
        <div data-bind="text: sourceA$" style="margin-left: 50px;"></div>
    visibleA: <span data-bind="text: visibleA"></span>
    enabledA: <span data-bind="text: enabledA"></span>
}
</pre>
<h1>A second set of drop zones on the same page</h1>
<div class="kj-stage" style="height: 400px; width: 500px; transform: scale(0.6);">
    <div data-role="stage" style="position: relative; height: 600px; width: 800px;">
        <div class="kj-element" style="position: absolute; top: 100px; left: 150px; width: 250px; height: 250px;">
            <div class="k-header" data-role="dropzone" data-bind="value: valueB1, source: sourceB, visible: visibleB, enabled: enabledB" style="width: 250px; height: 250px;">Drag the small circles here.</div>
        </div>
        <div class="kj-element" style="position: absolute; top: 50px; left: 50px; width: 50px; height: 50px;">
            <div data-behavior="draggable" data-id="draggableB1" data-constant="red" style="border: solid 1px blue; border-radius: 50%; background-color: red; width: 50px; height: 50px;"></div>
        </div>
        <div class="kj-element" style="position: absolute; top: 150px; left: 50px; width: 40px; height: 40px;">
            <div data-behavior="draggable" data-id="draggableB2" data-constant="blue" style="border: solid 1px blue; border-radius: 50%; background-color: blue; width: 40px; height: 40px;"></div>
        </div>
        <div class="kj-element" style="position: absolute; top: 250px; left: 50px; width: 30px; height: 30px;">
            <div data-behavior="draggable" data-id="draggableB3" data-constant="green" style="border: solid 1px blue; border-radius: 50%; background-color: green; width: 30px; height: 30px;"></div>
        </div>
        <div class="kj-element" style="position: absolute; top: 200px; left: 200px; width: 20px; height: 20px;">
            <div data-behavior="draggable" data-id="draggableB4" data-constant="yellow" style="border: solid 1px blue; border-radius: 50%; background-color: yellow; width: 20px; height: 20px;"></div>
        </div>
    </div>
</div>
<div>
    <input type="checkbox" data-bind="checked: visibleB" />Visible&nbsp;
    <input type="checkbox" data-bind="checked: enabledB" />Enabled&nbsp;
</div>
<pre>
{
    valueB1: <span data-bind="text: valueB1$"></span>
    sourceB$:
        <div data-bind="text: sourceB$" style="margin-left: 50px;"></div>
    visibleB: <span data-bind="text: visibleB"></span>
    enabledB: <span data-bind="text: enabledB"></span>
}
</pre>
</body>
</html>
