<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>widgets.propertygrid</title>
    <script>
        window.DEBUG = true;
    </script>
    <!-- Kidoju fonts -->
    <link href="../../styles/fonts/kidoju.css" rel="stylesheet">
    <!-- Kidoju theme -->
    <link href="../../styles/themes/app.theme.nordic.css" rel="stylesheet">
    <!-- SystemJS loader -->
    <script src="../../../test/vendor/polyfill.min.js"></script>
    <script src="../../../test/vendor/system.js"></script>
    <script src="../../js/helpers/system.config.js"></script>
    <script>
        (function () {
            'use strict';
            Promise.all([
                SystemJS.import('kendo.binder'),
                SystemJS.import('kendo.colorpicker'),
                SystemJS.import('kendo.datepicker'),
                SystemJS.import('kendo.dropdownlist'),
                SystemJS.import('kendo.switch'),
                SystemJS.import('kendo.numerictextbox'),
                SystemJS.import('kendo.slider'),
                // SystemJS.import('./widgets.multiinput'),
                SystemJS.import('./widgets.propertygrid.es6'),
                SystemJS.import('./widgets.rating.es6')
            ]).then(function () {
                var kendo = window.kendo;
                //This function is taken from http://demos.kendoui.com/web/grid/editing-custom.html
                function categoryDropDownEditor(container, options) {
                    $('<input data-bind="value: ' + options.field + '" style="width: 100%;"/>')
                    .appendTo(container)
                    .kendoDropDownList({
                        autoBind: false,
                        dataTextField: 'CategoryName',
                        dataValueField: 'CategoryID',
                        valuePrimitive: true,
                        dataSource: {
                            type: "odata",
                            transport: {
                                read: "http://demos.kendoui.com/service/Northwind.svc/Categories"
                            }
                        }
                    });
                }
                var Properties = kendo.data.Model.define({
                        id: 'docId', // the identifier of the model
                        fields: {
                            docId: {
                                type: 'string',
                                nullable: false,
                                editable: false,
                                defaultValue: '00000000-0000-0000-0000-000000000000'
                            },
                            title: {
                                type: 'string',
                                nullable: true,
                                validation: {
                                    required: true,
                                    title: function(input) {
                                        return !input.is('[name="title"]');
                                    }
                                }
                            },
                            description: {
                                type: 'string',
                                nullable: true,
                                validation: {
                                    required: true,
                                    description(input) {
                                        if (input.is('[name="description"]') && input.val() !== '') {
                                            input.attr('data-description-msg',
                                                'Description should start with capital letter');
                                            return /^[A-Z]/.test(input.val());
                                        }
                                        return true;
                                    }
                                }
                            },
                            category: {
                                type: 'string',
                                nullable: true,
                                validation: {
                                    required: true,
                                    category(input) {
                                        // debugger;
                                        if (input.is('[name="category"]') && input.val() != '') {
                                            input.attr('data-category-msg',
                                                'Category should start with A');
                                            return /^A/.test(input.val());
                                        }
                                        return true;
                                    }
                                }
                            },
                            tags: {
                                type: 'string',
                                nullable: true
                            },
                            language: {
                                type: 'string',
                                nullable: true
                            },
                            author: {
                                type: 'string',
                                //nullable: false,
                                editable: false,
                                defaultValue: 'John Smith'
                            },
                            width: {
                                type: 'number',
                                defaultValue: 500,
                                validation: {
                                    min: 490,
                                    max: 510
                                }
                            },
                            height: {
                                type: 'number',
                                defaultValue: 300
                            },
                            background: {
                                type: 'string',
                                validation: {
                                    pattern: '^B'
                                }
                            },
                            colour: {
                                type: 'string',
                                defaultValue: '#FF0000',
                                validation: {
                                    required: true
                                }
                            },
                            creationDate: {
                                type: 'date',
                                nullable: false,
                                validation: {
                                    creationDate(input) {
                                        // debugger;
                                        if (input.is('[name="creationDate"]') && input.val() !== '') {
                                            input.attr('data-creationDate-msg',
                                                'Product Name should start with capital letter');
                                            return /^[A-Z]/.test(input.val());
                                        }
                                        return true;
                                    }
                                }
                            },
                            like: {
                                type: 'boolean'
                            },
                            rating: {
                                type: 'number',
                                defaultValue: 0
                            },
                            views: {
                                type: 'number',
                                nullable: false,
                                editable: false
                            }
                        }
                    });
                var viewModel = new Properties();
                var rows = [
                        //See the columns property of a kendoGrid
                        //See http://docs.kendoui.com/getting-started/framework/globalization/numberformatting
                        //See http://docs.kendoui.com/getting-started/framework/globalization/dateformatting
                        //We have also introduced controls:
                        //- url
                        //- textarea
                        //- list
                        //- rating
                        { field: 'title', title: 'Title', help: 'Enter a title' },
                        { field: 'description', title: 'Description', editor: 'textarea', help: 'Enter a description' },
                        { field: 'category', title: 'Category', editor: categoryDropDownEditor },
                        { field: 'tags', title: 'Tags', editor: 'multiinput' },
                        { field: 'language', title: 'Language' },
                        { field: 'author', title: 'Author' },
                        { field: 'width', title: 'Width', attributes: { min: 100, max: 500, step: 50, 'data-format': 'n0' } },
                        { field: 'height', title: 'Height', editor: 'slider', attributes: { min: -100,  max: 100, smallStep: 5, largeStep: 50 } },
                        { field: 'background', title: 'Background', editor: 'url' },
                        { field: 'colour', title: 'Colour', editor: 'colorpicker' },
                        { field: 'creationDate', title: 'Creation Date', editor: 'datepicker', attributes: { 'data-format': 'dd MMM yyyy' } },
                        { field: 'like', title: 'Like'},
                        { field: 'rating', title: 'Rating', editor: 'rating'},
                        { field: 'views', title: 'Views' }
                    ];
                $(function(){
                    $('#grid1').kendoPropertyGrid({
                        value: viewModel,
                        rows: rows
                    });

                    //Read-only property grid
                    $('#grid2').kendoPropertyGrid({
                        value: viewModel,
                        rows: rows,
                        enabled: false
                    });

                    //Property grid bound to nothing (should gracefully fallback)
                    $('#grid3').kendoPropertyGrid();

                    //Property grid initialized with an object without schema and without row metadata (best guesses based on value types)
                    $('#grid4').kendoPropertyGrid({
                        value: {
                            string: 'Hello',
                            number: 100,
                            boolean: false,
                            date: new Date(),
                            object: { oops: true }
                        }
                    });

                    // Property grid bound to an object with row metadata but without schema (best guesses based on value types)
                    $('#grid5').kendoPropertyGrid({
                        value: {
                            string: 'Hello',
                            number: 100,
                            boolean: false,
                            date: new Date(),
                            object: { oops: true }
                        },
                        rows: [
                            { field: 'number', title: 'Count' },
                            { field: 'boolean', title: 'Approved' }
                        ]
                    });

                    // Property grid bound to an object with schema but without row metadata (property names used has titles)
                    $('#grid6').kendoPropertyGrid({
                        value: viewModel
                    });
                });
            });
        }());
    </script>
</head>
<body>
<h1>widgets.propertygrid</h1>
<h2>Preferred configuration</h2>
<h3>Property grid bound to an object with schema and with row metadata</h3>
<div id="grid1"></div>
<h2>Other configurations</h2>
<h3>Read-only property grid</h3>
<div id="grid2"></div>
<h3>Property grid withount initialization (should gracefully fallback)</h3>
<div id="grid3"></div>
<h3>Property grid bound to an object without schema and without row metadata (best guesses based on value types)</h3>
<div id="grid4"></div>
<h3>Property grid bound to an object with row metadata but without schema (best guesses based on value types)</h3>
<div id="grid5"></div>
<h3>Property grid bound to an object with schema but without row metadata (property names used has titles)</h3>
<div id="grid6"></div>
</body>
</html>
