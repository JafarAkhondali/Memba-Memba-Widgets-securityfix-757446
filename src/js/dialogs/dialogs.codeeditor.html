<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>dialogs.codeeditor</title>
    <script>
        window.DEBUG = true;
    </script>
    <!-- Kidoju fonts -->
    <link href="../../styles/fonts/kidoju.css" rel="stylesheet">
    <!-- Kidoju theme -->
    <link href="../../styles/themes/app.theme.nordic.css" rel="stylesheet">
    <!-- widgets.codeeditor stylesheet -->
    <link href="../../styles/vendor/codemirror/lib/codemirror.css" rel="stylesheet">
    <link href="../../styles/vendor/codemirror/addon/lint/lint.css" rel="stylesheet">
    <link href="../../styles/widgets/widgets.codeeditor.css" rel="stylesheet">
    <!-- SystemJS loader -->
    <script src="../../../test/vendor/polyfill.min.js"></script>
    <script src="../../../test/vendor/system.js"></script>
    <script src="../helpers/system.config.js"></script>
    <script>
        (function () {
            'use strict';
            Promise.all([
                SystemJS.import('kendo.binder'),
                SystemJS.import('../data/data.pagecomponent.es6'),
                SystemJS.import('../helpers/helpers.components.es6'),
                SystemJS.import('../tools/tools.es6'),
                SystemJS.import('./dialogs.codeeditor.es6')
            ]).then(function (modules) {
                var kendo = window.kendo;
                var PageComponent = modules[1].PageComponent;
                var component = modules[2].getTextBox();
                var library = modules[2].getValidationLibrary();
                var tools = modules[3].default;
                var openCodeEditor = modules[4].default;
                component.properties.solution = Math.trunc(100 * Math.random());
                component.properties.validation =
                    'function validate(value, solution, all) {\n\treturn parseInt(value, 10) === 5 + parseInt(solution, 10);\n}';
                tools.load(component.tool).then(() => {
                    $(function() {
                        $('#button1').click(function(e) {
                            openCodeEditor({
                                title: 'My Code',
                                data: {
                                    value: new PageComponent(component),
                                    library: new kendo.data.DataSource({data: library})
                                },
                                width: 860
                            }).then(function(result) {
                                $("#console1").append(
                                    kendo.format(
                                        '<div>action `{0}` with data `{1}` at {2}</div>',
                                        result.action,
                                        JSON.stringify(result.data.value.get('properties.validation')).substr(0, 40),
                                        new Date().toLocaleTimeString()
                                    )
                                );
                            });
                        });
                    });
                });
            });
        }());
    </script>
    <style type="text/css">
        .highlight-section {
            margin-top: 10px;
            width: 600px;
            padding: 7px 7px 7px 7px;
            min-height: 35px;
        }
    </style>
</head>

<body>

<h1>dialogs.codeeditor</h1>

<h2>openCodeEditor</h2>
<button id="button1" class="k-button">Show Me!</button>
<div id="console1" class="highlight-section k-block" style="margin-top:20px;"></div>

</body>
</html>
