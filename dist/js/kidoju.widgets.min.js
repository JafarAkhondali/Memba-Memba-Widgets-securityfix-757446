// Kidoju.Widgets 0.0.1 built on 25-02-2015 - Copyright ©2013-2015 Memba® Sarl. All rights reserved.

!function(a,b,c){"use strict";var d=a.kendo,e=(d.Class,d.data.Model),f=d.data.DataSource,g=(d.data.ObservableArray,a.kidoju=a.kidoju||{}),h="object",i="string",j="number",k="change",l="error",m=0,n=-1,o=g.PageComponent=e.define({id:"id",fields:{id:{type:i,editable:!1},tool:{type:i,editable:!1,nullable:!0},top:{type:j,defaultValue:m},left:{type:j,defaultValue:m},height:{type:j,defaultValue:n},width:{type:j,defaultValue:n},rotate:{type:j,defaultValue:m,parse:function(a){return(a+360)%360}},tag:{type:i,defaultValue:null},attributes:{defaultValue:{}},properties:{defaultValue:{}}},init:function(a){var c=this;if(b.type(a)===h){if(!g.tools)throw new Error("Kidoju tools are missing");if(b.type(a.tool)!==i||0===a.tool.length||!(g.tools[a.tool]instanceof g.Tool))throw new Error(d.format("`{0}` is not a valid Kidoju tool",a.tool));a=b.extend({},c.defaults,a)}if(e.fn.init.call(c,a),g.tools&&b.type(c.tool)===i&&c.tool.length){var f=g.tools[c.tool];if(f instanceof g.Tool){var j=f._getAttributeModel(),k=b.extend({},j.prototype.defaults,c.attributes),l=f._getPropertyModel(),m=b.extend({},l.prototype.defaults,c.properties);c.accept({attributes:new j(k),properties:new l(m)})}}},page:function(){var a=this.parent();return a.parent()}}),p=g.PageComponentCollectionDataSource=f.extend({init:function(a){var c=o.define({components:a});f.fn.init.call(this,b.extend(!0,{},{schema:{modelBase:c,model:c}},a))},remove:function(a){return f.fn.remove.call(this,a)},insert:function(a,b){if(b){if(!(b instanceof o)){var c=b;b=this._createNewModel(),b.accept(c)}return f.fn.insert.call(this,a,b)}}});p.create=function(a){a=a&&a.push?{data:a}:a;var b=a||{},c=b.data;if(b.data=c,!(b instanceof p)&&b instanceof f)throw new Error("Incorrect DataSource type. Only PageComponentCollectionDataSource instances are supported");return b instanceof p?b:new p(b)};var q=g.Page=e.define({id:"id",fields:{id:{type:i,editable:!1},style:{type:i}},init:function(a){var c=this;e.fn.init.call(c,a),c._componentsOptions={},b.isPlainObject(c.components)&&b.extend(c._componentsOptions,c.components),a&&b.isArray(a.components)&&b.extend(c._componentsOptions,{data:a.components}),c._initComponents(),c._loaded=!(!a||!a.components&&!a._loaded)},_initComponents:function(){var a,b,c,d=this;d.components instanceof p||(a=d.components=new p(d._componentsOptions),b=a.transport,c=b.parameterMap,b.parameterMap=function(a,b){return a[d.idField||"id"]=d.id,c&&(a=c(a,b)),a},a.parent=function(){return d})},append:function(a){this._initComponents(),this.loaded(!0),this.components.add(a)},_componentsLoaded:function(){this._loaded=!0},load:function(){var a,d,e={},f="_query";return this._initComponents(),a=this.components,e[this.idField||"id"]=this.id,this._loaded||(a._data=c,f="read"),a.one(k,b.proxy(this._componentsLoaded,this)),d=a[f](e),d||b.Deferred().resolve().promise()},stream:function(){var a=this.parent();return a.parent()},loaded:function(a){return a===c?this._loaded:void(this._loaded=a)},shouldSerialize:function(a){return e.fn.shouldSerialize.call(this,a)&&"components"!==a&&"_loaded"!==a&&"_componentsOptions"!==a}}),r=g.PageCollectionDataSource=f.extend({init:function(a){var c=q.define({components:a});f.fn.init.call(this,b.extend(!0,{},{schema:{modelBase:c,model:c}},a)),this._attachBubbleHandlers()},_attachBubbleHandlers:function(){var a=this;a._data.bind(l,function(b){a.trigger(l,b)})},remove:function(a){return f.fn.remove.call(this,a)},insert:function(a,b){if(b){if(!(b instanceof q)){var c=b;b=this._createNewModel(),b.accept(c)}return f.fn.insert.call(this,a,b)}},getObjectFromProperties:function(){for(var a={},b=this.data(),c=0;c<b.length;c++){b[c].load();for(var e=b[c].components.data(),f=0;f<e.length;f++){var g=e[f].properties||{};for(var h in g)g.hasOwnProperty(h)&&(a[g[h].name]=g[h].value)}}return d.observable(a)}});r.create=function(a){a=a&&a.push?{data:a}:a;var b=a||{},c=b.data;if(b.data=c,!(b instanceof r)&&b instanceof f)throw new Error("Incorrect DataSource type. Only PageCollectionDataSource instances are supported");return b instanceof r?b:new r(b)};g.Stream=e.define({id:"id",fields:{id:{type:i,editable:!1}},init:function(a){var c=this;e.fn.init.call(c,a),c._pagesOptions={},b.isPlainObject(c.pages)&&b.extend(c._pagesOptions,c.pages),a&&a.pages&&b.extend(c._pagesOptions,{data:a.pages}),c._initPages(),c._loaded=!(!a||!a.pages&&!a._loaded)},_initPages:function(){var a,b,c,d=this;d.pages instanceof r||(a=d.pages=new r(d._pagesOptions),b=a.transport,c=b.parameterMap,b.parameterMap=function(a,b){return a[d.idField||"id"]=d.id,c&&(a=c(a,b)),a},a.parent=function(){return d})},append:function(a){this._initPages(),this.loaded(!0),this.pages.add(a)},_pagesLoaded:function(){this._loaded=!0},load:function(){var a,d,e={},f="_query";return this._initPages(),a=this.pages,e[this.idField||"id"]=this.id,this._loaded||(a._data=c,f="read"),a.one(k,b.proxy(this._pagesLoaded,this)),d=a[f](e),d||b.Deferred().resolve().promise()},save:function(){var a=this,c=[];return c.push(a.pages.sync()),b.each(a.pages.data(),function(a,b){c.push(b.components.sync())}),b.when.apply(b,c)},loaded:function(a){return a===c?this._loaded:void(this._loaded=a)},shouldSerialize:function(a){return e.fn.shouldSerialize.call(this,a)&&"pages"!==a&&"_loaded"!==a&&"_pagesOptions"!==a}})}(this,jQuery),function(a,b,c){"use strict";var d=a.kendo,e=a.kidoju=a.kidoju||{},f="object",g="string",h="number",i="boolean",j="date",k="default",l="crosshair",m="register",n="active",o="pointer",p=".kj-element",q="absolute";e.tools=d.observable({active:null,register:function(a){if(b.type(a.fn)===f){var c=new a;if(c instanceof r&&b.type(c.id)===g){if(c.id===n||c.id===m)throw new Error("You cannot name your tool `active` or `register`");this[c.id]||(this[c.id]=c,c.id===o&&(this.active=o))}}}});var r=e.Tool=d.Class.extend({id:null,icon:null,cursor:null,height:250,width:250,attributes:{},properties:{},init:function(a){b.type(a)===f&&(b.type(a.id)===g&&(this.id=a.id),b.type(a.icon)===g&&(this.icon=a.icon),b.type(a.cursor)===g&&(this.cursor=a.cursor),b.type(a.height)===h&&(this.height=a.height),b.type(a.width)===h&&(this.width=a.width))},_getAttributeModel:function(){var a={fields:{}};for(var b in this.attributes)this.attributes.hasOwnProperty(b)&&this.attributes[b]instanceof s.BaseAdapter&&(a.fields[b]=this.attributes[b].getField());return d.data.Model.define(a)},_getAttributeRows:function(){var a=[];a.push(new s.NumberAdapter({attributes:{"data-min":0}}).getRow("top")),a.push((new s.NumberAdapter).getRow("left")),a.push((new s.NumberAdapter).getRow("height")),a.push((new s.NumberAdapter).getRow("width")),a.push((new s.NumberAdapter).getRow("rotate"));for(var b in this.attributes)this.attributes.hasOwnProperty(b)&&this.attributes[b]instanceof s.BaseAdapter&&a.push(this.attributes[b].getRow("attributes."+b));return a},_getPropertyModel:function(){var a={fields:{}};for(var b in this.properties)this.properties.hasOwnProperty(b)&&this.properties[b]instanceof s.BaseAdapter&&(a.fields[b]=this.properties[b].getField());return d.data.Model.define(a)},_getPropertyRows:function(){var a=[];for(var b in this.properties)this.properties.hasOwnProperty(b)&&this.properties[b]instanceof s.BaseAdapter&&a.push(this.properties[b].getRow("properties."+b));return a},getHtml:function(){throw new Error("Please implement in subclassed tool.")}});e.Tool.getStandardProperties=function(){return{name:new s.NameAdapter({title:"Name"}),validation:new s.ValidationAdapter({title:"Validation"}),success:new s.ScoreAdapter({title:"Success"}),failure:new s.ScoreAdapter({title:"Failure"}),omit:new s.ScoreAdapter({title:"Omit"})}};var s=e.adapters={};s.BaseAdapter=d.Class.extend({type:c,init:function(a){a=a||{},this.defaultValue=a.defaultValue,this.editable=a.editable,this.nullable=a.nullable,this.parse=a.parse,this.from=a.from,this.validation=a.validation,this.field=a.field,this.title=a.title,this.format=a.format,this.template=a.template,this.editor=a.editor,this.attributes=a.attributes},getField:function(){var a={};return[g,h,i,j].indexOf(this.type)>-1&&(a.type=this.type),(b.type(this.defaultValue)===this.type||this.type===c)&&(a.defaultValue=this.defaultValue),b.type(this.editable)===i&&(a.editable=this.defaultValue),b.type(this.nullable)===i&&(a.nullable=this.nullable),b.isFunction(this.parse)&&(a.parse=this.parse),b.type(this.from)===g&&(a.from=this.from),b.type(this.validation)===f&&(a.validation=this.validation),a},getRow:function(a){if(b.type(a)!==g||0===a.length)throw new TypeError;var d={};return d.field=a,b.type(this.title)===g&&(d.title=this.title),b.type(this.format)===g&&(d.format=this.format),b.type(this.template)===g&&(d.template=this.template),(b.isFunction(this.editor)||b.type(this.editor)===g&&(e.editors===c||b.isFunction(e.editors[this.editor])))&&(d.editor=this.editor),b.isPlainObject(this.attributes)&&(d.attributes=this.attributes),d}}),s.StringAdapter=s.BaseAdapter.extend({init:function(a){s.BaseAdapter.fn.init.call(this,a),this.type=g,this.editor="textbox",this.defaultValue=this.defaultValue||(this.nullable?null:"")}}),s.NumberAdapter=s.BaseAdapter.extend({init:function(a){s.BaseAdapter.fn.init.call(this,a),this.type=h,this.defaultValue=this.defaultValue||(this.nullable?null:0),this.editor="_kendoInput",this.attributes=b.extend({},this.attributes,{"data-role":"numerictextbox"})}}),s.BooleanAdapter=s.BaseAdapter.extend({init:function(a){s.BaseAdapter.fn.init.call(this,a),this.type=i,this.defaultValue=this.defaultValue||(this.nullable?null:!1),this.editor="_kendoInput",this.attributes=b.extend({},this.attributes,{"data-role":"switch"})}}),s.DateAdapter=s.BaseAdapter.extend({init:function(a){s.BaseAdapter.fn.init.call(this,a),this.type=j,this.defaultValue=this.defaultValue||(this.nullable?null:new Date),this.editor="_kendoInput",this.attributes=b.extend({},this.attributes,{"data-role":"datepicker"})}}),s.StyleAdapter=s.BaseAdapter.extend({init:function(c){s.BaseAdapter.fn.init.call(this,c),this.type=g,this.defaultValue=this.defaultValue||(this.nullable?null:""),this.editor=function(c,d){var e=b("<div/>").css({display:"table"}).appendTo(c),f=b("<span/>").css({display:"table-cell",width:"100%",paddingRight:"8px"}).appendTo(e),g=b("<input/>").addClass("k-textbox").css({border:"solid 1px #FF0000",width:"100%"}).attr(b.extend({},d.attributes,{"data-bind":"value: "+d.field})).appendTo(f);b("<button/>").text("...").addClass("k-button").css({display:"table-cell",minWidth:"40px",height:g.css("height"),margin:0}).appendTo(e).on("click",function(){a.alert("coucou")})}}}),s.NameAdapter=s.StringAdapter.extend({}),s.ValidationAdapter=s.BaseAdapter.extend({}),s.ScoreAdapter=s.NumberAdapter.extend({});var t=e.Tool.extend({id:o,icon:"mouse_pointer",cursor:k,height:0,width:0,getHtml:c});e.tools.register(t);var u=e.Tool.extend({id:"label",icon:"document_orientation_landscape",cursor:l,templates:{"default":'<span style="#= attributes.style #">#: attributes.text #</span>'},height:100,width:300,attributes:{text:new s.StringAdapter({defaultValue:"Label"}),style:new s.StyleAdapter({defaultValue:"font-family: Georgia, serif; color: #FF0000;"})},getHtml:function(a){if(a instanceof e.PageComponent){var b=d.template(this.templates["default"]);return b(a)}},onResize:function(a,c){var d=b(a.currentTarget);if(d.is(p)&&c instanceof e.PageComponent){var f=d.find(">span");b.type(c.width)===h&&f.width(c.width),b.type(c.height)===h&&f.height(c.height);var g=parseInt(f.css("font-size")),i=f.clone().hide().css({position:q,height:"auto"}).width(c.width);for(d.after(i);i.height()<c.height;)g++,i.css("font-size",g);for(;i.height()>c.height;)g--,i.css("font-size",g);i.remove(),f.css("font-size",g),a.preventDefault(),a.stopPropagation()}}});e.tools.register(u);var v=e.Tool.extend({id:"image",icon:"painting_landscape",cursor:l,templates:{"default":'<img src="#= attributes.src #" alt="#: attributes.alt #">'},height:250,width:250,attributes:{src:new s.StringAdapter,alt:new s.StringAdapter},getHtml:function(a){if(a instanceof e.PageComponent){var b=d.template(this.templates["default"]);return b(a)}},onResize:function(a,c){var d=b(a.currentTarget);if(d.is(p)&&c instanceof e.PageComponent){var f=d.find(">img");b.type(c.width)===h&&f.width(c.width),b.type(c.height)===h&&f.height(c.height),a.preventDefault(),a.stopPropagation()}}});e.tools.register(v);var w=e.Tool.extend({id:"textbox",icon:"text_field",cursor:l,templates:{"default":'<input type="text" style="#= attributes.style #" data-bind="value: #: properties.name #">'},height:100,width:300,attributes:{style:new s.StyleAdapter},properties:e.Tool.getStandardProperties(),getHtml:function(a){if(a instanceof e.PageComponent){var b=d.template(this.templates["default"]);return b(a)}},onResize:function(a,c){var d=b(a.currentTarget);if(d.is(p)&&c instanceof e.PageComponent){var f=d.find(">input");b.type(c.width)===h&&f.width(c.width),b.type(c.height)===h&&(f.height(c.height),f.css("font-size",Math.floor(.75*c.height))),a.preventDefault(),a.stopPropagation()}}});e.tools.register(w);var x=e.Tool.extend({id:"button",icon:"button",cursor:l,templates:{"default":'<button type="button" style="#= attributes.style #">#: attributes.text #</button>'},height:100,width:300,attributes:{style:new s.StyleAdapter,text:new s.StringAdapter({defaultValue:"Button"})},properties:e.Tool.getStandardProperties(),getHtml:function(a){if(a instanceof e.PageComponent){var b=d.template(this.templates["default"]);return b(a)}},addEvents:function(){},removeEvents:function(){},onResize:function(a,c){var d=b(a.currentTarget);if(d.is(p)&&c instanceof e.PageComponent){var f=d.find(">button");b.type(c.width)===h&&f.width(c.width),b.type(c.height)===h&&(f.height(c.height),f.css("font-size",Math.floor(.75*c.height))),a.preventDefault(),a.stopPropagation()}}});e.tools.register(x)}(this,jQuery),function(a,b){"use strict";function c(a){return b.type(a)===h&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(a)}var d=a.kendo,e=d.data,f=e.binders,g=e.Binder,h=(d.ui,"string"),i="number",j="change";f.widget.index=g.extend({init:function(a,c,d){g.fn.init.call(this,a.element[0],c,d),this.widget=a,this._change=b.proxy(this.change,this),this.widget.bind(j,this._change)},change:function(){this.bindings.index.set(this.widget.index())},refresh:function(){var a=this.bindings.index.get();b.type(a)===i&&this.widget.index(a)},destroy:function(){this.widget.unbind(j,this._change)}}),f.widget.id=g.extend({init:function(a,c,d){g.fn.init.call(this,a.element[0],c,d),this.widget=a,this._change=b.proxy(this.change,this),this.widget.bind(j,this._change)},change:function(){this.bindings.id.set(this.widget.id())},refresh:function(){var a=this.bindings.id.get();c(a)&&this.widget.id(a)},destroy:function(){this.widget.unbind(j,this._change)}}),f.widget.selection=g.extend({init:function(a,c,d){g.fn.init.call(this,a.element[0],c,d),this.widget=a,this._change=b.proxy(this.change,this),this.widget.bind(j,this._change)},change:function(){this.bindings.selection.set(this.widget.selection())},refresh:function(){this.widget.selection(this.bindings.selection.get())},destroy:function(){this.widget.unbind(j,this._change)}}),f.widget.properties=g.extend({init:function(a,c,d){g.fn.init.call(this,a.element[0],c,d),this.widget=a,this._change=b.proxy(this.change,this),this.widget.bind(j,this._change)},change:function(){this.bindings.properties.set(this.widget.properties())},refresh:function(){this.widget.properties(this.bindings.properties.get())},destroy:function(){this.widget.unbind(j,this._change)}})}(this,jQuery),function(a,b){"use strict";function c(c){g&&a.console&&b.isFunction(a.console.log)&&a.console.log(h+c)}var d=a.kendo,e=(d.data,d.ui.Widget),f="k-widget kj-explorer",g=!1,h="kidoju.widgets.designbar: ",i=e.extend({init:function(a,b){var d=this;e.fn.init.call(this,a,b),c("widget initialized"),d._layout()},options:{name:"Designbar"},_layout:function(){var a=this;b(a.element).html(a.options.name)},_clear:function(){var a=this;b(a.element).find("*").off(),b(a.element).off().empty().removeClass(f)},destroy:function(){var a=this;e.fn.destroy.call(a),a._clear(),d.destroy(a.element)}});d.ui.plugin(i)}(this,jQuery),function(a,b,c){"use strict";function d(c){y&&a.console&&b.isFunction(a.console.log)&&a.console.log(z+c)}function e(a){return b.type(a)===i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(a)}var f=a.kendo,g=(f.data,f.ui.Widget),h=a.kidoju,i="string",j="number",k=null,l="change",m="click",n="dataBinding",o="dataBound",p="mouseenter",q="mouseleave",r=".kendoExplorer",s="k-widget k-group kj-explorer",t="k-state-hover",u="k-state-selected",v="li.k-item[data-uid]",w='li.k-item[data-uid="{0}"]',x="aria-selected",y=!1,z="kidoju.widgets.explorer: ",A=g.extend({init:function(a,b){var c=this;g.fn.init.call(this,a,b),d("widget initialized"),c._templates(),c._layout(),c._dataSource()},options:{name:"Explorer",index:0,id:null,autoBind:!0,itemTemplate:'<li data-uid="#= uid #" tabindex="-1" unselectable="on" role="option" class="k-item kj-explorer-item"><span class="k-in"><img class="k-image kj-explorer-icon" alt="#= tool #" src="#= icon #">#= tool #</span></li>',iconPath:"./styles/images/toolbox/",messages:{empty:"No item to display"}},setOptions:function(a){g.fn.setOptions.call(this,a)},events:[l,n,o],index:function(a){var e,f=this;if(a===c)return e=f.dataSource.getByUid(f._selectedUid),e instanceof h.PageComponent?f.dataSource.indexOf(e):-1;if(d("index set to "+a),b.type(a)!==j)throw new TypeError;if(0>a||a>0&&a>=f.length())throw new RangeError;e=f.dataSource.at(a),f.selection(e)},id:function(a){var b,d=this;if(a===c)return b=d.dataSource.getByUid(d._selectedUid),b instanceof h.PageComponent?b[b.idField]:c;if(!e(a))throw new TypeError;b=d.dataSource.get(a),d.selection(b)},selection:function(a){var d=this;if(null===a)b.noop();else{if(a===c)return d.dataSource.getByUid(d._selectedUid);if(!(a instanceof h.PageComponent))throw new TypeError;if(e(d._selectedUid)||0!==d.length()){if(a.uid!==d._selectedUid){var f=d.dataSource.indexOf(a);if(f>=0){d._selectedUid=a.uid;var g=b.Event(l,{index:f,id:a[a.idField],value:a});d.refresh(g),d.trigger(l,g)}}}else d._tmp=a}},length:function(){return this.dataSource instanceof h.PageComponentCollectionDataSource?this.dataSource.total():0},items:function(){return this.list[0].children},_templates:function(){var a=this;a.itemTemplate=f.template(a.options.itemTemplate)},setDataSource:function(a){this.options.dataSource=a,this._dataSource()},_dataSource:function(){var a=this;a.dataSource instanceof h.PageComponentCollectionDataSource&&a._refreshHandler&&a.dataSource.unbind(l,a._refreshHandler),a.options.dataSource!==k&&(a.dataSource=h.PageComponentCollectionDataSource.create(a.options.dataSource),a._refreshHandler=b.proxy(a.refresh,a),a.dataSource.bind(l,a._refreshHandler),a.options.autoBind&&a.dataSource.fetch())},_layout:function(){var a=this,c=a.element;a.list=c.find("ul.k-list"),a.list.length||(a.list=b('<ul tabindex="-1" unselectable="on" role="listbox" class="k-list k-reset" />').appendTo(c)),c.on(p+r+" "+q+r,v,a._toggleHover).on(m+r,v,b.proxy(a._click,a)).addClass(s),f.notify(a)},refresh:function(a){var b=this,d="";if(!a||"itemchange"!==a.action){if(a===c||a.type!==l){var e=[];a===c&&b.dataSource instanceof h.PageComponentCollectionDataSource?e=b.dataSource.data():a&&a.items instanceof f.data.ObservableArray&&(e=a.items),a&&a.action===c&&b.trigger(n);for(var g=0;g<e.length;g++){var i=h.tools[e[g].tool];i instanceof h.Tool&&(d+=b.itemTemplate({uid:e[g].uid,tool:e[g].tool,icon:b.options.iconPath+i.icon+".svg"}))}d.length>0&&b._tmp instanceof h.PageComponent?(b.selection(b._tmp),delete b._tmp):0===d.length&&(d=b.options.messages.empty),b.list.html(d),a&&a.action===c&&b.trigger(o)}b.list.find(v).removeClass(u).removeProp(x),b.list.find(f.format(w,b._selectedUid)).addClass(u).prop(x,!0)}},_toggleHover:function(a){b(a.currentTarget).toggleClass(t,a.type===p)},_click:function(a){var c=b(a.currentTarget);if(a.preventDefault(),!c.is("."+u)){var d=this.dataSource.getByUid(c.attr(f.attr("uid")));this.selection(d)}},_clear:function(){var a=this,b=a.element;f.unbind(b),b.find("*").off(),b.off(r).empty().removeClass(s)},destroy:function(){var a=this;g.fn.destroy.call(a),a._clear(),a.setDataSource(k),f.destroy(a.element)}});f.ui.plugin(A)}(this,jQuery),function(a,b,c){"use strict";function d(c){w&&a.console&&b.isFunction(a.console.log)&&a.console.log(x+c)}function e(a){return b.type(a)===k&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(a)}var f=a.kendo,g=(f.data,f.ui.Widget),h=a.kidoju,i=null,j="number",k="string",l="change",m="click",n="mouseenter",o="mouseleave",p=".kendoNavigation",q="k-widget k-group kj-navigation",r="k-state-selected",s=".kj-navigation-page[data-uid]",t='.kj-navigation-page[data-uid="{0}"]',u="aria-selected",v=20,w=!1,x="kidoju.widgets.navigation: ",y=g.extend({init:function(a,b){var c=this;g.fn.init.call(this,a,b),d("widget initialized"),c._templates(),c._layout(),c._dataSource()},options:{name:"Navigation",autoBind:!0,itemTemplate:'<div data-uid="#= uid #" class="kj-navigation-page" role="option" aria-selected="false"><div data-role="stage"></div></div>',addTemplate:'<div data-uid="#= uid #" class="kj-navigation-page" role="option" aria-selected="false"><div>#: text #</div></div>',pageWidth:1024,pageHeight:768,selectionBorder:10,pageSpacing:20,messages:{newPage:"New Page"}},index:function(a){var e,f=this;if(a===c)return e=f.dataSource.getByUid(f._selectedUid),e instanceof h.Page?f.dataSource.indexOf(e):-1;if(d("index set to "+a),b.type(a)!==j)throw new TypeError;if(0>a||a>0&&a>=f.length())throw new RangeError;e=f.dataSource.at(a),f.selection(e)},id:function(a){var b,d=this;if(a===c)return b=d.dataSource.getByUid(d._selectedUid),b instanceof h.Page?b[b.idField]:c;if(!e(a))throw new TypeError;b=d.dataSource.get(a),d.selection(b)},selection:function(a){var d=this;if(a===c)return d.dataSource.getByUid(d._selectedUid);if(!(a instanceof h.Page))throw new TypeError;if(e(d._selectedUid)||0!==d.length()){if(a.uid!==d._selectedUid){var f=d.dataSource.indexOf(a);if(f>=0){d._selectedUid=a.uid;var g=b.Event(l,{index:f,id:a[a.idField],value:a});d.refresh(g),d.trigger(l,g)}}}else d._tmp=a},length:function(){return this.dataSource instanceof h.PageCollectionDataSource?this.dataSource.total():0},height:function(a){var c=this;if(!a)return c.options.height;if(b.type(a)!==j)throw new TypeError;if(0>a)throw new RangeError;a!==c.options.height&&(c.options.height=a)},width:function(a){var c=this;if(!a)return c.options.width;if(b.type(a)!==j)throw new TypeError;if(0>a)throw new RangeError;a!==c.options.width&&(c.options.width=a)},_templates:function(){this.itemTemplate=f.template(this.options.itemTemplate),this.addTemplate=f.template(this.options.addTemplate)},setDataSource:function(a){this.options.dataSource=a,this._dataSource()},_dataSource:function(){var a=this;a.dataSource instanceof h.PageCollectionDataSource&&a._refreshHandler&&a.dataSource.unbind(l,a._refreshHandler),a.options.dataSource!==i&&(a.dataSource=h.PageCollectionDataSource.create(a.options.dataSource),a._refreshHandler=b.proxy(a.refresh,a),a.dataSource.bind(l,a._refreshHandler),a.options.autoBind&&a.dataSource.fetch())},_layout:function(){var a=this;a.element.addClass(q).attr("role","listbox").on(m+p,s,b.proxy(a._clickHandler,a)).on(n+p+" "+o+p,s,a._toggleHover)},refresh:function(a){var d=this,e=d.element,g=(e.width()-v-2*parseInt(d.options.pageSpacing))/d.options.pageWidth;if(a===c||a.action===c){var i=[];a===c&&d.dataSource instanceof h.PageCollectionDataSource?i=d.dataSource.data():a.items&&(i=a.items);for(var j=0;j<i.length;j++)i[j]instanceof h.Page&&(e.find(f.format(t,i[j].uid)).length||b(d.itemTemplate({uid:i[j].uid})).css("box-sizing","border-box").css("position","relative").css("padding",parseInt(d.options.selectionBorder)).css("margin",parseInt(d.options.pageSpacing)-parseInt(d.options.selectionBorder)).append('<div style="position:absolute; top: 10px; left: 10px; height: 20px; width: 20px; background-color: black;"></div>').appendTo(e).find(f.roleSelector("stage")).kendoStage({mode:f.ui.Stage.fn.modes.thumbnail,dataSource:i[j].components,scale:g}))}d.displaySelection(),d.resize()},displaySelection:function(){var a=this,b=a.element;b.find(s).removeClass(r).removeProp(u),b.find(f.format(t,a._selectedUid)).addClass(r).prop(u,!0)},resize:function(){var a=this,c=a.element,d=(c.width()-2*parseInt(a.options.pageSpacing))/a.options.pageWidth;0>d&&(d=0),c.find(s).width(d*parseInt(a.options.pageWidth)).height(d*parseInt(a.options.pageHeight));for(var e=c.find(f.roleSelector("stage")),g=0;g<e.length;g++)b(e[g]).data("kendoStage").scale(d)},_toggleHover:function(a){if(a instanceof b.Event){var c=b(a.currentTarget);c.toggleClass("k-state-hover",a.type===n)}},_clickHandler:function(a){if(a instanceof b.Event){{var c=b(a.currentTarget);c.closest(f.roleSelector("navigation"))}if(a.preventDefault(),!c.is("."+r)){var d=this.dataSource.getByUid(c.attr(f.attr("uid")));this.selection(d)}}},_clear:function(){var a=this;f.unbind(a.element),a.element.find("*").off(),a.element.off().empty().removeClass(q)},destroy:function(){var a=this;g.fn.destroy.call(a),a._clear(),a.setDataSource(i),f.destroy(a.element)}});f.ui.plugin(y)}(this,jQuery),function(a,b,c){"use strict";function d(c){B&&a.console&&b.isFunction(a.console.log)&&a.console.log(C+c)}function e(a){return b.type(a)===p&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(a)}function f(a,b,c,d,e){return a({idx:b,text:c,ns:m.ns,numeric:d,title:e||""})}function g(a,b,c,d){return a({className:b.substring(1),text:c,wrapClassName:d||""})}function h(a,b,c,d){a.find(b).parent().attr(m.attr("index"),c).attr("tabindex",-1).toggleClass("k-state-disabled",d)}function i(a,b){h(a,x,0,0>=b)}function j(a,b){h(a,z,Math.max(0,b-1),0>=b)}function k(a,b,c){h(a,A,Math.min(c-1,b+1),b>=c-1)}function l(a,b,c){h(a,y,c-1,b>=c-1)}var m=a.kendo,n=(m.data,m.ui.Widget),o=a.kidoju,p="string",q="number",r=null,s="change",t="click",u="keydown",v=".kendoPlaybar",w="k-widget kj-playbar",x=".k-i-seek-w",y=".k-i-seek-e",z=".k-i-arrow-w",A=".k-i-arrow-e",B=!1,C="kidoju.widgets.playbar: ",D=n.extend({init:function(a,b){var c=this;b=b||{},n.fn.init.call(c,a,b),d("widget initialized"),c._index=c.options.index||0,c._templates(),c._layout(),c._dataSource()},options:{name:"Playbar",iconTemplate:'<a href="\\#" title="#:text#" class="k-link k-pager-nav #= wrapClassName #"><span class="k-icon #= className #">#:text#</span></a>',selectTemplate:'<li><span class="k-state-selected">#: text #</span></li>',linkTemplate:'<li><a tabindex="-1" href="\\#" class="k-link" data-#=ns#index="#=idx#" #if (title !== "") {# title="#=title#" #}#>#:text#</a></li>',buttonCount:10,autoBind:!0,index:0,numeric:!0,info:!0,timer:!0,input:!1,previousNext:!0,refresh:!0,dataSource:c,messages:{empty:"No page to display",page:"Page",of:"of {0}",first:"Go to the first page",previous:"Go to the previous page",next:"Go to the next page",last:"Go to the last page",refresh:"Refresh",morePages:"More pages"}},events:[s],index:function(a){var e=this;if(a===c)return e._index;if(d("index set to "+a),b.type(a)!==q)throw new TypeError;if(0>a||a>0&&a>=e.length())throw new RangeError;if(a!==e._index){e._index=a,e.refresh();var f=e.dataSource.at(e._index);e.trigger(s,{index:a,id:f instanceof o.Page?f[f.idField]:c,value:f})}},id:function(a){var b,d=this;if(a===c)return b=d.dataSource.at(d._index),b instanceof o.Page?b[b.idField]:c;if(!e(a))throw new TypeError;if(b=d.dataSource.get(a),b!==c){var f=d.dataSource.indexOf(b);f>=0&&d.index(f)}},value:function(a){var b=this;if(a===c)return b.dataSource.at(b._index);var d=b.dataSource.indexOf(a);d>=0&&b.index(d)},length:function(){return this.dataSource instanceof o.PageCollectionDataSource?this.dataSource.total():0},_templates:function(){var a=this;a.iconTemplate=m.template(a.options.iconTemplate),a.linkTemplate=m.template(a.options.linkTemplate),a.selectTemplate=m.template(a.options.selectTemplate)},setDataSource:function(a){this.options.dataSource=a,this._dataSource()},_dataSource:function(){var a=this;a.dataSource instanceof o.PageCollectionDataSource&&a._refreshHandler&&a.dataSource.unbind(s,a._refreshHandler),a.options.dataSource!==r&&(a.dataSource=o.PageCollectionDataSource.create(a.options.dataSource),a._refreshHandler=b.proxy(a.refresh,a),a.dataSource.bind(s,a._refreshHandler),a.options.autoBind&&a.dataSource.fetch())},_layout:function(){var a=this,c=a.element,d=a.options,e=a.index(),f=a.length();d.previousNext&&(c.find(x).length||(c.append(g(a.iconTemplate,x,d.messages.first,"k-pager-first")),i(c,e,f)),c.find(z).length||(c.append(g(a.iconTemplate,z,d.messages.previous)),j(c,e,f))),d.numeric&&(a.list=c.find(".k-pager-numbers"),a.list.length||(a.list=b('<ul class="k-pager-numbers k-reset" />').appendTo(c))),d.input&&(c.find(".k-pager-input").length||c.append('<span class="k-pager-input k-label">'+d.messages.page+'<input class="k-textbox">'+m.format(d.messages.of,f)+"</span>"),c.on(u+v,".k-pager-input input",b.proxy(a._keydown,a))),d.previousNext&&(c.find(A).length||(c.append(g(a.iconTemplate,A,d.messages.next)),k(c,e,f)),c.find(y).length||(c.append(g(a.iconTemplate,y,d.messages.last,"k-pager-last")),l(c,e,f))),d.refresh&&(c.find(".k-pager-refresh").length||c.append('<a href="#" class="k-pager-refresh k-link" title="'+d.messages.refresh+'"><span class="k-icon k-i-refresh">'+d.messages.refresh+"</span></a>"),c.on(t+v,".k-pager-refresh",b.proxy(a._refreshClick,a))),d.info&&(c.find(".k-pager-info").length||c.append('<span class="k-pager-info k-label" />')),c.on(t+v,"a",b.proxy(a._indexClick,a)).addClass(w+" k-pager-wrap k-widget"),m.notify(a)},refresh:function(a){var b,c,d=this,e=(d.element,d.options),g=d.index(),h=d.length(),n=0,o="";if(!a||"itemchange"!==a.action){if(e.numeric){for(g>e.buttonCount-1&&(n=g-g%e.buttonCount),c=Math.min(n+e.buttonCount-1,h-1),n>0&&(o+=f(d.linkTemplate,n-1,"...",!1,e.messages.morePages)),b=n;c>=b;b++)o+=f(b===g?d.selectTemplate:d.linkTemplate,b,b+1,!0);h-1>c&&(o+=f(d.linkTemplate,b,"...",!1,e.messages.morePages)),""===o&&(o=d.selectTemplate({text:0})),d.list.html(o)}e.info&&(o=h>0?e.messages.page+" "+(g+1)+" "+m.format(e.messages.of,h):e.messages.empty,d.element.find(".k-pager-info").html(o)),e.input&&d.element.find(".k-pager-input").html(e.messages.page+'<input class="k-textbox">'+m.format(e.messages.of,h)).find("input").val(g+1).attr("disabled",1>h).toggleClass("k-state-disabled",1>h),e.previousNext&&(i(d.element,g,h),j(d.element,g,h),k(d.element,g,h),l(d.element,g,h))}},_keydown:function(a){if(a.keyCode===m.keys.ENTER){var b=this.element.find(".k-pager-input").find("input"),c=parseInt(b.val(),10);(isNaN(c)||1>c||c>this.length())&&(c=this.index()+1),b.val(c),this.index(c-1)}},_refreshClick:function(a){a.preventDefault(),this.dataSource.read()},_indexClick:function(a){var c=b(a.currentTarget);a.preventDefault(),c.is(".k-state-disabled")||this.index(parseInt(c.attr(m.attr("index")),10))},_clear:function(){var a=this;b(a.element).find("*").off(),b(a.element).off().empty().removeClass(w)},destroy:function(){var a=this;n.fn.destroy.call(a),a._clear(),a.setDataSource(r),m.destroy(a.element)}});m.ui.plugin(D)}(this,jQuery),function(a,b,c){"use strict";var d=a.kendo,e=d.ui,f=e.Widget,g=a.kidoju=a.kidoju||{},h="object",i="string",j="number",k="boolean",l="date",m=null,n=/^_/,o="tbody",p='td[role="gridcell"]',q=!1,r="kidoju.widgets.propertygrid: ",s=f.extend({init:function(a,c){var d=this;f.fn.init.call(this,a,c),d.wrapper=d.element,d._layout(),b.type(d.options.value)===h&&d.refresh()},options:{name:"PropertyGrid",value:m,rows:m,templates:{row:'<tr role="row"><td role="gridcell">#: title #</td><td role="gridcell"></td></tr>',altRow:'<tr class="k-alt" role="row"><td role="gridcell">#: title #</td><td role="gridcell"></td></tr>'},messages:{property:"Property",value:"Value"}},value:function(a){var d=this;if(null===a)b.isEmptyObject(d.options.value)||(d.options.value={},d.refresh());else{if(a===c)return d.options.value;if(b.type(a)!==h)throw new TypeError("Properties should be an object");
a!==d.options.value&&(d.options.value=a,d.refresh())}},rows:function(a){var d=this;if(a===c)return d.options.rows;if(!b.isArray(a))throw new TypeError("Rows should be an object");a!==d.options.rows&&(d.options.rows=a,d.refresh())},_layout:function(){var a=this;a.element.addClass("k-grid k-widget").append('<div class="k-grid-header" style="padding-right: 17px;"><div class="k-grid-header-wrap"><table role="grid"><colgroup><col><col></colgroup><thead role="rowgroup"><tr role="row"><th role="columnheader" class="k-header">'+a.options.messages.property+'</th><th role="columnheader" class="k-header">'+a.options.messages.value+"</th></tr></thead></table></div></div>").append('<div class="k-grid-content"><table role="grid" style="height: auto;"><colgroup><col><col></colgroup><tbody role="rowgroup"></tbody></table></div>')},refresh:function(){var a=this,c=a.options.value,e=b(a.element).find(o).first();if(d.unbind(e),d.destroy(e),e.find("*").off(),e.empty(),b.type(c)===h){for(var f=d.template(a.options.templates.row),g=d.template(a.options.templates.altRow),i=a._buildRows(),j=0,k=0;k<i.length;k++){var l=i[k];if(l){var m=(k-j)%2===1?g:f;e.append(m({title:l.title}));var n=e.find(p).last(),q=b.extend({},l,{model:c});l.editor(n,q)}else j++}d.bind(e,c,d.ui,d.mobile.ui)}},_buildRows:function(){function a(d,g,i){var j=d.fields,k=d.defaults;for(var l in d)if(d.hasOwnProperty(l)&&!n.test(l)&&!b.isFunction(d[l])&&(!f||g.hasOwnProperty(l)))if(b.type(d[l])===h)a(d[l],g[l]||{},0===i.length?l:i+"."+l);else{var m={attributes:f&&g[l]&&g[l].attributes?g[l].attributes:c,editable:j&&j[l]&&j[l].editable===!1?!1:!0,editor:f&&g[l]&&g[l].editor?g[l].editor:c,field:0===i.length?l:i+"."+l,format:f&&g[l]&&g[l].format?g[l].format:c,template:f&&g[l]&&g[l].template?g[l].template:c,title:f&&g[l]&&g[l].title?g[l].title:u.formatTitle(l),type:u.getType(j&&j[l],k&&k[l],d[l])};u.optimizeEditor(m),m.type&&(f?e[g[l]._index]=m:e.push(m))}}var d=this,e=[],f=b.isArray(d.options.rows);return a(d.options.value,u.hash(d.options.rows),""),e},_clear:function(){var a=this;d.unbind(a.element),d.destroy(a.element),a.element.find("*").off(),a.element.off().empty().removeClass("k-widget k-grid")},destroy:function(){var a=this;a._clear(),f.fn.destroy.call(this)}});e.plugin(s);var t=g.editors={span:function(a,c){b("<span/>").attr(b.extend({},c.attributes,{"data-bind":"value: "+c.field})).appendTo(a)},textbox:function(a,c){b('<input type="text" class="k-textbox" style="width: 100%;"/>').attr(b.extend({},c.attributes,{"data-bind":"value: "+c.field})).appendTo(a)},textarea:function(a,c){b('<textarea class="k-textbox" style="width: 100%; resize: vertical;"/>').attr(b.extend({},c.attributes,{"data-bind":"value: "+c.field})).appendTo(a)},_kendoInput:function(a,c){b('<input style="width: 100%;"/>').attr(b.extend({},c.attributes,{"data-bind":"value: "+c.field})).appendTo(a)},_template:function(a,c){var e=d.template(c.template);b(e(c)).appendTo(a)}},u={log:function(c){q&&a.console&&b.isFunction(a.console.log)&&a.console.log(r+c)},hash:function(a){var c={};return b.isArray(a)&&b.each(a,function(a,b){for(var d=b.field.split("."),e=c,f=0;f<d.length;f++)e=e[d[f]]=e[d[f]]||{};e._index=a;for(var g in b)b.hasOwnProperty(g)&&(e[g]=b[g])}),c},formatTitle:function(a){return d.toHyphens(a).replace(/(^\w|-\w)/g,function(a){return a.replace("-"," ").toUpperCase()})},getType:function(a,d,e){var f,g=["string","number","boolean","date"];return a&&g.indexOf(a.type)>-1?a.type:d!==c&&null!==d?(f=b.type(d),g.indexOf(f)>-1?f:c):e!==c&&null!==e?(f=b.type(e),g.indexOf(f)>-1?f:c):i},optimizeEditor:function(a){if(!a.editable)return void(a.editor=t.span);if(!b.isFunction(a.editor)){if(b.type(a.editor)===i){if(a.editor=a.editor.toLowerCase(),a.editor.length&&!n.test(a.editor)&&b.isFunction(t[a.editor]))return void(a.editor=t[a.editor]);var e=["colorpicker","datepicker","datetimepicker","maskedtextbox","multiinput","numerictextbox","rating","slider","switch","timepicker"];if(e.indexOf(a.editor)>-1&&(d.rolesFromNamespaces(d.ui).hasOwnProperty(a.editor)||d.rolesFromNamespaces(d.mobile.ui).hasOwnProperty(a.editor)))return a.attributes=b.extend({},a.attributes,{"data-role":a.editor}),void(a.editor=t._kendoInput)}if(a.editor=c,b.type(a.template)===i&&a.template.length)return void(a.editor=t._template);switch(a.type){case j:a.attributes=b.extend({},a.attributes,{"data-role":"numerictextbox"}),a.editor=t._kendoInput;break;case k:a.attributes=b.extend({},a.attributes,{"data-role":"switch"}),a.editor=t._kendoInput;break;case l:a.attributes=b.extend({},a.attributes,{"data-role":"datepicker"}),a.editor=t._kendoInput;break;default:a.editor=t.textbox}}}}}(this,jQuery),function(a,b,c){"use strict";var d=a.kendo,e=d.ui,f=e.Widget,g=a.kidoju,h="string",i="number",j=null,k=".kendoStage",l="mousedown",m="mousemove",n="mouseup",o="touchstart",p="touchmove",q="touchend",r="change",s="dataBinding",t="dataBound",u="propertyBinding",v="propertyBound",w="select",x="move",y="resize",z="rotate",A="absolute",B="relative",C="hidden",D="display",E="block",F="none",G="top",H="left",I="height",J="width",K="cursor",L="transform",M="rotate({0}deg)",N="scale({0})",O='<div class="k-widget kj-stage" />',P='<div data-id="{0}" data-tool="{1}" class="kj-element"></div>',Q='.kj-element[data-id="{0}"]',R=".kj-element",S='<div class="kj-overlay"></div>',T=".kj-overlay",U='<div class="kj-handle-box"></div>',V='.kj-handle-box[data-id="{0}"]',W=".kj-handle-box",X='<span class="kj-handle" data-command="move"></span>',Y='<span class="kj-handle" data-command="resize"></span>',Z='<span class="kj-handle" data-command="rotate"></span>',$='<span class="kj-handle" data-command="menu"></span>',_=".kj-handle",ab="data-id",bb="data-command",cb="state",db={MOVE:"move",RESIZE:"resize",ROTATE:"rotate",MENU:"menu"},eb="pointer",fb="active",gb={MODE:"thumbnail",SCALE:1,WIDTH:1024,HEIGHT:768},hb=!1,ib='<div class="debug-mouse"></div>',jb=".debug-mouse",kb='<div class="debug-bounds"></div>',lb=".debug-bounds",mb='<div class="debug-center"></div>',nb=".debug-center",ob="kidoju.widgets.stage: ",pb=f.extend({init:function(a,b){var c=this;f.fn.init.call(c,a,b),qb.log("widget initialized"),c.setOptions(b),c._layout(),c._dataSource()},modes:{thumbnail:"thumbnail",design:"design",play:"play"},events:[r,s,t,u,v,w],options:{name:"Stage",autoBind:!0,mode:gb.MODE,scale:gb.SCALE,height:gb.HEIGHT,width:gb.WIDTH,tools:g.tools,dataSource:c},setOptions:function(a){f.fn.setOptions.call(this,a),this._mode=this.options.mode,this._scale=this.options.scale,this._height=this.options.height,this._width=this.options.width},mode:function(a){var d=this;if(a===c)return d._mode;if(b.type(a)!==h)throw new TypeError;if(!d.modes[a])throw new RangeError;a!==d._mode&&(d._mode=a,d._initializeMode())},scale:function(a){var e=this;if(a===c)return e._scale;if(b.type(a)!==i)throw new TypeError;if(0>a)throw new RangeError;a!==e._scale&&(e._scale=a,e.wrapper.css({transformOrigin:"0 0",transform:d.format(N,e._scale)}),e.wrapper.find(_).css({transform:d.format(N,1/e._scale)}))},height:function(a){var c=this;if(!a)return c.options.height;if(b.type(a)!==i)throw new TypeError;if(0>a)throw new RangeError;a!==c.options.height&&(c.options.height=a)},width:function(a){var c=this;if(!a)return c.options.width;if(b.type(a)!==i)throw new TypeError;if(0>a)throw new RangeError;a!==c.options.width&&(c.options.width=a)},properties:function(a){var b=this;return a?void(a!==b._properties&&(b._properties=a)):b._properties},setDataSource:function(a){this.options.dataSource=a,this._dataSource()},_dataSource:function(){var a=this;a.dataSource instanceof g.PageComponentCollectionDataSource&&a._refreshHandler&&a.dataSource.unbind(r,a._refreshHandler),a.options.dataSource!==j&&(a.dataSource=g.PageComponentCollectionDataSource.create(a.options.dataSource),a._refreshHandler=b.proxy(a.refresh,a),a.dataSource.bind(r,a._refreshHandler),a.options.autoBind&&a.dataSource.fetch())},_layout:function(){var a=this;a._clear(),a.stage=a.element.wrap(O).css({position:B,overflow:C,height:a.height(),width:a.width()}),a.wrapper=a.stage.parent().css({position:B,height:a.height(),width:a.width(),transformOrigin:"0 0",transform:d.format(N,a.scale())}),a._initializeMode()},_initializeMode:function(){var a=this;switch(a._clearMode(),a.mode()){case a.modes.thumbnail:a._initializeThumbnailMode();break;case a.modes.design:a._initializeDesignMode();break;case a.modes.play:a._initializePlayMode()}},_clearMode:function(){var a=this;a.wrapper.off(k),a.stage.off(k),a.wrapper.find(W).remove(),a.wrapper.find(T).remove(),b.isFunction(a._propertyBinding)&&a.unbind(u,a._propertyBinding),b.each(a.stage.find(R),function(a,b){d.unbind(b)})},_addElementEventHandlers:function(){var a=this;a.stage.on(x+k,R,function(c,e){if(a.options.tools instanceof d.data.ObservableObject){var f=a.options.tools[e.tool];f instanceof g.Tool&&b.isFunction(f.onMove)&&f.onMove(c,e)}}),a.stage.on(y+k,R,function(c,e){if(a.options.tools instanceof d.data.ObservableObject){var f=a.options.tools[e.tool];f instanceof g.Tool&&b.isFunction(f.onResize)&&f.onResize(c,e)}}),a.stage.on(z+k,R,function(c,e){if(a.options.tools instanceof d.data.ObservableObject){var f=a.options.tools[e.tool];f instanceof g.Tool&&b.isFunction(f.onRotate)&&f.onRotate(c,e)}})},_initializeThumbnailMode:function(){var a=this;b(S).css({position:A,display:E,top:0,left:0,height:a.height(),width:a.width()}).appendTo(a.wrapper),a._addElementEventHandlers()},_initializeDesignMode:function(){var a=this;b(U).css({position:A,display:F}).append(X).append(Y).append(Z).append($).appendTo(a.wrapper),a.wrapper.on(l+k+" "+o+k,b.proxy(a._onMouseDown,a)),a.wrapper.on(m+k+" "+p+k,b.proxy(a._onMouseMove,a)),a.wrapper.on(n+k+" "+q+k,b.proxy(a._onMouseUp,a)),a._addElementEventHandlers(),qb.addDebugVisualElements(a.wrapper),a.menu=b('<ul class="kj-stage-menu"></ul>').append('<li data-command="lock">Lock</li>').append('<li data-command="delete">Delete</li>').appendTo(a.wrapper).kendoContextMenu({target:'.kj-handle[data-command="menu"]',showOn:l+" "+o,select:b.proxy(a._contextMenuSelectHandler,a)}).data("kendoContextMenu"),b.noop()},_contextMenuSelectHandler:function(a){var c=this;switch(b(a.item).attr(bb)){case"lock":break;case"delete":var d=c.wrapper.find(W).attr(ab),e=c.dataSource.get(d);c.dataSource.remove(e)}},_initializePlayMode:function(){var a=this;a._addElementEventHandlers(),b.isFunction(a._propertyBinding)&&a.unbind(u,a._propertyBinding),a._propertyBinding=b.proxy(function(){var a=this;a.properties()instanceof d.data.ObservableObject&&b.each(a.stage.find(R),function(b,c){d.bind(c,a.properties())})},a),a.bind(u,a._propertyBinding)},_addStageElement:function(a,c,e){var f=this;if(a instanceof g.PageComponent&&0===f.stage.find(d.format(Q,a.id)).length){b.type(c)===i&&b.type(e)===i&&(a.set(H,c),a.set(G,e));var h=f.options.tools[a.tool];if(h instanceof g.Tool){var j=b(d.format(P,a.id,a.tool)).css({position:A,top:a.get(G),left:a.get(H),height:a.get(I),width:a.get(J),transform:d.format(M,a.get(z))});j.append(h.getHtml(a)),f.stage.append(j),j.trigger(x+k,a),j.trigger(y+k,a),j.trigger(z+k,a)}}},_removeStageElement:function(a){var b=this.stage.find(d.format(Q,a));d.unbind(b),b.off(k).remove()},_showHandles:function(a){var b=this,c=b.wrapper.find(W);if(c.length){var e=b.stage.find(d.format(Q,a));c.css({top:e.css(G),left:e.css(H),height:e.css(I),width:e.css(J),transform:e.css(L),display:E}).attr(ab,a),c.find(_).css({transform:d.format(M,-qb.getTransformRotation(e))+" "+d.format(N,1/b.scale())})}},_hideHandles:function(){this.wrapper.find(W).css({display:F}).removeAttr(ab)},_onMouseDown:function(a){var c=this,e=c.options.tools.get(fb),f=b(a.target),h=qb.getMousePosition(a),i=f.closest(R),j=f.closest(_);if(e!==eb){var k=c.options.tools[e];if(k instanceof g.Tool){var l=new g.PageComponent({id:d.guid(),tool:k.id,left:h.x,top:h.y,width:k.width,height:k.height});c.dataSource.add(l)}c.options.tools.set(fb,eb)}else if(j.length){var m=j.attr(bb);if(m===db.MENU)b.noop();else{var n=c.wrapper.find(W),o=n.attr(ab);i=c.stage.find(d.format(Q,o)),n.data(cb,{command:m,top:parseFloat(i.css(G))||0,left:parseFloat(i.css(H))||0,height:i.height(),width:i.width(),angle:qb.getTransformRotation(i),scale:qb.getTransformScale(c.wrapper),snapGrid:0,snapAngle:0,mouseX:h.x,mouseY:h.y,id:o}),b(document.body).css(K,f.css(K))}}else c.select(i.length||f.is(W)?i.attr(ab):null);a.preventDefault(),a.stopPropagation()},_onMouseMove:function(a){var c=this,e=c.wrapper.find(W),f=e.data(cb);if(b.isPlainObject(f)){var g=qb.getMousePosition(a),h=c.stage.find(d.format(Q,f.id)),i=c.options.dataSource.get(f.id),j=h[0].getBoundingClientRect(),k={left:j.left-c.stage.offset().left+b(document.body).scrollLeft(),top:j.top-c.stage.offset().top+b(document.body).scrollTop(),height:j.height,width:j.width},l={x:k.left+k.width/2,y:k.top+k.height/2};if(qb.updateDebugVisualElements({wrapper:c.wrapper,mouse:g,center:l,bounds:k,scale:f.scale}),f.command===db.MOVE)i.set(H,qb.snap(f.left+(g.x-f.mouseX)/f.scale,f.snapGrid)),i.set(G,qb.snap(f.top+(g.y-f.mouseY)/f.scale,f.snapGrid));else if(f.command===db.RESIZE){var m=(g.x-f.mouseX)/f.scale,n=(g.y-f.mouseY)/f.scale,o={x:l.x+m/2,y:l.y+n/2},p={x:f.left,y:f.top},q=qb.deg2rad(f.angle),r=qb.getRotatedPoint(p,l,q),s=qb.getRotatedPoint(r,o,-q);i.set(H,s.x),i.set(G,s.y),i.set(I,qb.snap(f.height-m*Math.sin(q)+n*Math.cos(q),f.snapGrid)),i.set(J,qb.snap(f.width+m*Math.cos(q)+n*Math.sin(q),f.snapGrid))}else if(f.command===db.ROTATE){var t=qb.getRadiansBetween2Points(l,{x:f.mouseX,y:f.mouseY},g),u=qb.snap((360+f.angle+qb.rad2deg(t))%360,f.snapAngle);i.set(z,u)}a.preventDefault(),a.stopPropagation()}},_onMouseUp:function(){var a=this,c=a.wrapper.find(W),d=c.data(cb);b.isPlainObject(d)&&(c.removeData(cb),b(document.body).css(K,""),qb.hideDebugVisualElements(a.wrapper))},refresh:function(a){var e=this;if(a===c||a.action===c){var f=[];a===c&&e.dataSource instanceof d.data.PageComponentCollectionDataSource?f=e.dataSource.data():a&&a.items instanceof d.data.ObservableArray&&(f=a.items),e._hideHandles(),e.trigger(s),b.each(e.stage.find(R),function(a,c){e._removeStageElement(b(c).attr(ab))}),b.each(f,function(a,b){e._addStageElement(b)}),e.trigger(t),e.trigger(u),e.trigger(v)}else"add"===a.action?b.each(a.items,function(b,c){e._addStageElement(c),e.trigger(r,{action:a.action,value:c}),e.select(c.id)}):"remove"===a.action?b.each(a.items,function(b,c){e._removeStageElement(c.id),e.trigger(r,{action:a.action,value:c}),e.wrapper.find(W).attr(ab)===c.id&&e.select(null)}):"itemchange"===a.action&&b.each(a.items,function(b,c){var f=e.stage.find(d.format(Q,c.id)),g=e.wrapper.find(d.format(V,c.id));if(f.length)switch(a.field){case H:f.css(H,c.left),g.css(H,c.left),f.trigger(x+k,c);break;case G:f.css(G,c.top),g.css(G,c.top),f.trigger(x+k,c);break;case I:f.css(I,c.height),g.css(I,c.height),f.trigger(y+k,c);break;case J:f.css(J,c.width),g.css(J,c.width),f.trigger(y+k,c);break;case z:f.css(L,d.format(M,c.rotate)),g.css(L,d.format(M,c.rotate)),g.find(_).css(L,d.format(M,-c.rotate)+" "+d.format(N,1/e.scale())),f.trigger(z+k,c)}})},select:function(a){var e=this;if(e.mode()===e.modes.design){if(a===c)return e.wrapper.find(W).attr(ab);b.type(a)===h&&e.stage.find(d.format(Q,a)).length&&e.wrapper.find(W).attr(ab)!==a?(e._showHandles(a),e.trigger(w,{value:e.options.dataSource.get(a)})):null===a&&e.wrapper.find(W).css(D)!==F&&(e._hideHandles(),e.trigger(w,{value:null}))}},items:function(){return this.stage.children()},_clear:function(){var a=this;d.unbind(a.element),a.element.find("*").off(),a.element.off().empty()},destroy:function(){var a=this;f.fn.destroy.call(a),a._clear(),a.setDataSource(j),d.destroy(a.element)}});d.ui.plugin(pb);var qb={log:function(c){hb&&a.console&&b.isFunction(a.console.log)&&a.console.log(ob+c)},deg2rad:function(a){return a*Math.PI/180},rad2deg:function(a){return 180*a/Math.PI},snap:function(a,b){return b?b/2>a%b?a-a%b:a+b-a%b:a},getTransformRotation:function(a){var c=(b(a).attr("style")||"").match(/rotate\([\s]*([0-9\.]+)[deg\s]*\)/);return b.isArray(c)&&c.length>1?parseFloat(c[1])||0:0},getTransformScale:function(a){var c=(b(a).attr("style")||"").match(/scale\([\s]*([0-9\.]+)[\s]*\)/);return b.isArray(c)&&c.length>1?parseFloat(c[1])||1:1},getMousePosition:function(a){var c=a.originalEvent&&a.originalEvent.touches?a.originalEvent.touches[0].clientX:a.clientX,e=a.originalEvent&&a.originalEvent.touches?a.originalEvent.touches[0].clientY:a.clientY,f=b(a.currentTarget).find(d.roleSelector("stage")),g={x:c-f.offset().left+b(document.body).scrollLeft(),y:e-f.offset().top+b(document.body).scrollTop()};return g},getRotatedPoint:function(a,d,e){return b.isPlainObject(a)&&"number"===b.type(a.x)&&"number"===b.type(a.y)&&b.isPlainObject(d)&&"number"===b.type(d.x)&&"number"===b.type(d.y)&&"number"===b.type(e)?{x:d.x+(a.x-d.x)*Math.cos(e)-(a.y-d.y)*Math.sin(e),y:d.y+(a.x-d.x)*Math.sin(e)+(a.y-d.y)*Math.cos(e)}:c},getRadiansBetween2Points:function(a,d,e){return b.isPlainObject(a)&&"number"===b.type(a.x)&&"number"===b.type(a.y)&&b.isPlainObject(d)&&"number"===b.type(d.x)&&"number"===b.type(d.y)&&b.isPlainObject(e)&&"number"===b.type(e.x)&&"number"===b.type(e.y)?Math.atan2(e.y-a.y,e.x-a.x)-Math.atan2(d.y-a.y,d.x-a.x):c},addDebugVisualElements:function(a){hb&&(b(kb).css({position:A,border:"1px dashed #FF00FF",display:F}).appendTo(a),b(mb).css({position:A,height:"20px",width:"20px",marginTop:"-10px",marginLeft:"-10px",borderRadius:"50%",backgroundColor:"#FF00FF",display:F}).appendTo(a),b(ib).css({position:A,height:"20px",width:"20px",marginTop:"-10px",marginLeft:"-10px",borderRadius:"50%",backgroundColor:"#00FFFF",display:F}).appendTo(a))},updateDebugVisualElements:function(a){hb&&b.isPlainObject(a)&&a.scale>0&&(a.wrapper.find(nb).css({display:"block",left:a.center.x/a.scale,top:a.center.y/a.scale}),a.wrapper.find(lb).css({display:"block",left:a.bounds.left/a.scale,top:a.bounds.top/a.scale,height:a.bounds.height/a.scale,width:a.bounds.width/a.scale}),a.wrapper.find(jb).css({display:"block",left:a.mouse.x/a.scale,top:a.mouse.y/a.scale}))},hideDebugVisualElements:function(a){hb&&(a.find(nb).css({display:F}),a.find(lb).css({display:F}),a.find(jb).css({display:F}))}}}(this,jQuery),function(a,b){"use strict";function c(c){r&&a.console&&b.isFunction(a.console.log)&&a.console.log(s+c)}var d=a.kendo,e=d.ui.Widget,f=a.kidoju,g="string",h="click",i="change",j="k-widget kj-toolbox",k='<img src="{0}" alt="{1}">',l="kj-tool",m="data-tool",n="data-selected",o="active",p="pointer",q=32,r=!1,s="kidoju.widgets.toolbox: ",t=e.extend({init:function(a,b){var d=this;b=b||{},e.fn.init.call(d,a,b),c("widget initialized"),d._layout()},options:{name:"Toolbox",size:q,path:"./styles/images/toolbox/",tools:f.tools},events:[],tool:function(a){var d=this;if(!a)return d.options.tools.get(o);if(b.type(a)!==g)throw new TypeError;if(!d.options.tools.hasOwnProperty(a))throw new RangeError;a!==d.options.tool&&(d.options.tools.set(o,a),c("tool changed for "+a))},reset:function(){var a=this;a.tool(p)},_layout:function(){var a=this;a._clear(),b(a.element).addClass(j),b.each(a.options.tools,function(c,e){if(e instanceof f.Tool&&a.options.tools.hasOwnProperty(e.id)){var g=b(d.format(k,a.options.path+e.icon+".svg","TODO: Translate")).attr(m,e.id).addClass(l).height(a.options.size).width(a.options.size);b(a.element).append(g)}}),b(a.element).find("img").on(h,function(c){var d=b(c.target).attr(m);b.type(d)===g&&a.tool(d)}),a.refresh(),b.isFunction(a._refreshHandler)&&a.options.tools.unbind(i,a._refreshHandler),a._refreshHandler=b.proxy(a.refresh,a),a.options.tools.bind(i,a._refreshHandler)},refresh:function(){var a=this;b(a.element).find("["+n+"]").removeProp(n),b(a.element).find("["+m+"="+a.tool()+"]").prop(n,!0)},_clear:function(){var a=this;b(a.element).find("*").off(),b(a.element).off(),b(a.element).empty(),b(a.element).removeClass(j)},destroy:function(){var a=this;e.fn.destroy.call(a),a._clear(),b.isFunction(a._refreshHandler)&&a.options.tools.unbind(i,a._refreshHandler),d.destroy(a.element)}});d.ui.plugin(t)}(this,jQuery);
//# sourceMappingURL=kidoju.widgets.min.map