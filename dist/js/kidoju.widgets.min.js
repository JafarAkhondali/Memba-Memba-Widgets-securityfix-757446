// Kidoju.Widgets 0.0.1 built on 23-03-2015 - Copyright ©2013-2015 Memba® Sarl. All rights reserved.

!function(a,b){"use strict";b(["./vendor/kendo/kendo.core","./vendor/kendo/kendo.data","./kidoju.tools"],a)}(function(){"use strict";return function(a,b){var c=window.kendo,d=c.data.Model,e=c.data.DataSource,f=window.kidoju=window.kidoju||{},g="object",h="string",i="number",j="change",k="error",l=0,m=-1,n=/^[a-z][a-z0-9_]{3,}$/i,o=f.PageComponent=d.define({id:"id",fields:{id:{type:h,editable:!1},tool:{type:h,editable:!1,nullable:!0},top:{type:i,defaultValue:l},left:{type:i,defaultValue:l},height:{type:i,defaultValue:m},width:{type:i,defaultValue:m},rotate:{type:i,defaultValue:l,parse:function(a){return(a+360)%360}},tag:{type:h,defaultValue:null},attributes:{defaultValue:{}},properties:{defaultValue:{}}},init:function(b){var e=this;if(a.type(b)===g){if(!f.tools)throw new Error("Kidoju tools are missing");if(a.type(b.tool)!==h||0===b.tool.length||!(f.tools[b.tool]instanceof f.Tool))throw new Error(c.format("`{0}` is not a valid Kidoju tool",b.tool));b=a.extend({},e.defaults,b)}if(d.fn.init.call(e,b),f.tools&&a.type(e.tool)===h&&e.tool.length){var i=f.tools[e.tool];if(i instanceof f.Tool){var j=i._getAttributeModel(),k=a.extend({},j.prototype.defaults,e.attributes),l=i._getPropertyModel(),m=a.extend({},l.prototype.defaults,e.properties);e.accept({attributes:new j(k),properties:new l(m)})}}},page:function(){var a=this.parent();return a.parent()}}),p=f.PageComponentCollectionDataSource=e.extend({init:function(b){var c=o.define({components:b});e.fn.init.call(this,a.extend(!0,{},{schema:{modelBase:c,model:c}},b))},remove:function(a){return e.fn.remove.call(this,a)},insert:function(a,b){if(b){if(!(b instanceof o)){var c=b;b=this._createNewModel(),b.accept(c)}return e.fn.insert.call(this,a,b)}}});p.create=function(a){a=a&&a.push?{data:a}:a;var b=a||{},c=b.data;if(b.data=c,!(b instanceof p)&&b instanceof e)throw new Error("Incorrect DataSource type. Only PageComponentCollectionDataSource instances are supported");return b instanceof p?b:new p(b)};var q=f.Page=d.define({id:"id",fields:{id:{type:h,editable:!1},style:{type:h}},init:function(b){var c=this;d.fn.init.call(c,b),c._componentsOptions={},a.isPlainObject(c.components)&&a.extend(c._componentsOptions,c.components),b&&a.isArray(b.components)&&a.extend(c._componentsOptions,{data:b.components}),c._initComponents(),c._loaded=!(!b||!b.components&&!b._loaded)},_initComponents:function(){var a,b,c,d=this;d.components instanceof p||(a=d.components=new p(d._componentsOptions),b=a.transport,c=b.parameterMap,b.parameterMap=function(a,b){return a[d.idField||"id"]=d.id,c&&(a=c(a,b)),a},a.parent=function(){return d})},append:function(a){this._initComponents(),this.loaded(!0),this.components.add(a)},_componentsLoaded:function(){this._loaded=!0},load:function(){var c,d,e={},f="_query";return this._initComponents(),c=this.components,e[this.idField||"id"]=this.id,this._loaded||(c._data=b,f="read"),c.one(j,a.proxy(this._componentsLoaded,this)),d=c[f](e),d||a.Deferred().resolve().promise()},stream:function(){var a=this.parent();return a.parent()},loaded:function(a){return a===b?this._loaded:void(this._loaded=a)},shouldSerialize:function(a){return d.fn.shouldSerialize.call(this,a)&&"components"!==a&&"_loaded"!==a&&"_componentsOptions"!==a}}),r=f.PageCollectionDataSource=e.extend({init:function(b){e.fn.init.call(this,a.extend(!0,{},{schema:{modelBase:q,model:q}},b)),this._attachBubbleHandlers()},_attachBubbleHandlers:function(){var a=this;a._data.bind(k,function(b){a.trigger(k,b)})},remove:function(a){return e.fn.remove.call(this,a)},insert:function(a,b){if(b){if(!(b instanceof q)){var c=b;b=this._createNewModel(),b.accept(c)}return e.fn.insert.call(this,a,b)}},getTestFromProperties:function(){var d=this,e={};return a.each(d.data(),function(d,f){a.each(f.components.data(),function(d,f){var i=f.properties;i instanceof c.data.Model&&a.type(i.fields)===g&&!a.isEmptyObject(i.fields)&&a.type(i.name)===h&&(e[i.name]=b)})}),e},validateNamedValue:function(c,d,e,f){var g=a.Deferred();if(!window.Worker)return g.reject({filename:b,lineno:b,message:"Web workers are not supported"}),g;if(a.type(c)!==h||!n.test(c))return g.reject({filename:b,lineno:b,message:"A valid name has not been provided"}),g;if(a.type(d)!==h)return g.reject({filename:b,lineno:b,message:"Code has not been provided"}),g;var i=new Blob(["onmessage=function(e){"+d+'if(typeof(e.data.value)==="undefined"){postMessage(e.data.value);}else{postMessage(validate(e.data.value,e.data.solution));}self.close();}']),j=window.URL.createObjectURL(i),k=new Worker(j);return k.onmessage=function(a){g.resolve({name:c,result:a.data})},k.onerror=function(a){g.reject(a)},k.postMessage({value:e,solution:f}),setTimeout(function(){k.terminate(),"pending"===g.state()&&g.reject({filename:b,lineno:b,message:"Timeout error"})},50),g.promise()},validateTestFromProperties:function(d){if(a.type(d)!==g)return b;var e=this,f=a.Deferred(),j=[],k={score:0,max:0,percent:function(){var a,b;return this instanceof c.data.ObservableObject?(a=this.get("max"),b=this.get("score")):(a=this.max,b=this.score),0===b||0===a?c.toString(0,"p0"):c.toString(b/a,"p0")},getScoreArray:function(){var a=[];for(var b in this)/^val_/.test(b)&&this.hasOwnProperty(b)&&a.push(this[b]);return a}};return a.each(e.data(),function(f,g){a.each(g.components.data(),function(f,g){var i=g.properties;i instanceof c.data.Model&&a.isPlainObject(i.fields)&&!a.isEmptyObject(i.fields)&&a.type(i.name)===h&&(j.push(e.validateNamedValue(i.name,i.validation,d[i.name],i.solution)),k[i.name]={name:i.name,description:i.description,value:d[i.name],solution:i.solution,result:b,omit:i.omit,failure:i.failure,success:i.success})})}),a.when.apply(a,j).done(function(){a.each(arguments,function(b,c){switch(k[c.name].result=c.result,c.result){case!0:k[c.name]&&a.type(k[c.name].success)===i&&(k[c.name].score=k[c.name].success);break;case!1:k[c.name]&&a.type(k[c.name].failure)===i&&(k[c.name].score=k[c.name].failure);break;default:k[c.name]&&a.type(k[c.name].omit)===i&&(k[c.name].score=k[c.name].omit)}k.score+=k[c.name].score,k[c.name]&&k[c.name].success&&(k.max+=k[c.name].success)}),f.resolve(k)}).fail(f.reject),f.promise()}});r.create=function(a){a=a&&a.push?{data:a}:a;var b=a||{},c=b.data;if(b.data=c,!(b instanceof r)&&b instanceof e)throw new Error("Incorrect DataSource type. Only PageCollectionDataSource instances are supported");return b instanceof r?b:new r(b)};f.Stream=d.define({id:"id",fields:{id:{type:h,editable:!1}},init:function(b){var c=this;d.fn.init.call(c,b),c._pagesOptions={},a.isPlainObject(c.pages)&&a.extend(c._pagesOptions,c.pages),b&&b.pages&&a.extend(c._pagesOptions,{data:b.pages}),c._initPages(),c._loaded=!(!b||!b.pages&&!b._loaded)},_initPages:function(){var a,b,c,d=this;d.pages instanceof r||(a=d.pages=new r(d._pagesOptions),b=a.transport,c=b.parameterMap,b.parameterMap=function(a,b){return a[d.idField||"id"]=d.id,c&&(a=c(a,b)),a},a.parent=function(){return d})},append:function(a){this._initPages(),this.loaded(!0),this.pages.add(a)},_pagesLoaded:function(){this._loaded=!0},load:function(){var c,d,e={},f="_query";return this._initPages(),c=this.pages,e[this.idField||"id"]=this.id,this._loaded||(c._data=b,f="read"),c.one(j,a.proxy(this._pagesLoaded,this)),d=c[f](e),d||a.Deferred().resolve().promise()},save:function(){var b=this,c=[];return c.push(b.pages.sync()),a.each(b.pages.data(),function(a,b){c.push(b.components.sync())}),a.when.apply(a,c)},loaded:function(a){return a===b?this._loaded:void(this._loaded=a)},shouldSerialize:function(a){return d.fn.shouldSerialize.call(this,a)&&"pages"!==a&&"_loaded"!==a&&"_pagesOptions"!==a}})}(jQuery),window.kidoju},"function"==typeof define&&define.amd?define:function(a,b){"use strict";b()}),function(a,b){"use strict";b(["./vendor/kendo/kendo.core","./vendor/kendo/kendo.data","./kidoju.data"],a)}(function(){"use strict";return function(a,b){var c=window.kendo,d=window.kidoju=window.kidoju||{},e="object",f="string",g="number",h="boolean",i="date",j="default",k="crosshair",l="register",m="active",n="pointer",o=".kj-element",p="absolute",q='<div class="k-popup-edit-form {0}"></div>',r=".kj-dialog",s="click",t=d.culture=d.culture||{};t.tools={},d.tools=c.observable({active:null,register:function(b){if(a.type(b.fn)===e){var c=new b;if(c instanceof u&&a.type(c.id)===f){if(c.id===m||c.id===l)throw new Error("You cannot name your tool `active` or `register`");this[c.id]||(this[c.id]=c,c.id===n&&(this.active=n))}}}});var u=d.Tool=c.Class.extend({id:null,icon:null,cursor:null,height:250,width:250,attributes:{},properties:{},init:function(b){a.type(b)===e&&(a.type(b.id)===f&&(this.id=b.id),a.type(b.icon)===f&&(this.icon=b.icon),a.type(b.cursor)===f&&(this.cursor=b.cursor),a.type(b.height)===g&&(this.height=b.height),a.type(b.width)===g&&(this.width=b.width))},_getAttributeModel:function(){var a={fields:{}};for(var b in this.attributes)this.attributes.hasOwnProperty(b)&&this.attributes[b]instanceof v.BaseAdapter&&(a.fields[b]=this.attributes[b].getField());return c.data.Model.define(a)},_getAttributeRows:function(){var a=[];a.push((new v.NumberAdapter).getRow("top")),a.push((new v.NumberAdapter).getRow("left")),a.push((new v.NumberAdapter).getRow("height")),a.push((new v.NumberAdapter).getRow("width")),a.push((new v.NumberAdapter).getRow("rotate"));for(var b in this.attributes)this.attributes.hasOwnProperty(b)&&this.attributes[b]instanceof v.BaseAdapter&&a.push(this.attributes[b].getRow("attributes."+b));return a},_getPropertyModel:function(){var a={fields:{}};for(var b in this.properties)this.properties.hasOwnProperty(b)&&this.properties[b]instanceof v.BaseAdapter&&(a.fields[b]=this.properties[b].getField(),"name"===b&&(a.fields[b].defaultValue="val_"+Math.floor(16777216*(1+Math.random())).toString(16).substring(1)));return c.data.Model.define(a)},_getPropertyRows:function(){var a=[];for(var b in this.properties)this.properties.hasOwnProperty(b)&&this.properties[b]instanceof v.BaseAdapter&&a.push(this.properties[b].getRow("properties."+b));return a},getHtml:function(){throw new Error("Please implement in subclassed tool.")}}),v=d.adapters={};v.BaseAdapter=c.Class.extend({type:b,init:function(a){a=a||{},this.defaultValue=a.defaultValue,this.editable=a.editable,this.nullable=a.nullable,this.parse=a.parse,this.from=a.from,this.validation=a.validation,this.field=a.field,this.title=a.title,this.format=a.format,this.template=a.template,this.editor=a.editor,this.attributes=a.attributes},getField:function(){var c={};return[f,g,h,i].indexOf(this.type)>-1&&(c.type=this.type),(a.type(this.defaultValue)===this.type||this.type===b)&&(c.defaultValue=this.defaultValue),a.type(this.editable)===h&&(c.editable=this.defaultValue),a.type(this.nullable)===h&&(c.nullable=this.nullable),a.isFunction(this.parse)&&(c.parse=this.parse),a.type(this.from)===f&&(c.from=this.from),a.type(this.validation)===e&&(c.validation=this.validation),c},getRow:function(c){if(a.type(c)!==f||0===c.length)throw new TypeError;var e={};return e.field=c,a.type(this.title)===f&&(e.title=this.title),a.type(this.format)===f&&(e.format=this.format),a.type(this.template)===f&&(e.template=this.template),(a.isFunction(this.editor)||a.type(this.editor)===f&&(d.editors===b||a.isFunction(d.editors[this.editor])))&&(e.editor=this.editor),a.isPlainObject(this.attributes)&&(e.attributes=this.attributes),e}}),v.StringAdapter=v.BaseAdapter.extend({init:function(b){v.BaseAdapter.fn.init.call(this,b),this.type=f,this.defaultValue=this.defaultValue||(this.nullable?null:""),this.editor="input",this.attributes=a.extend({},this.attributes,{type:"text","class":"k-textbox"})}}),v.NumberAdapter=v.BaseAdapter.extend({init:function(b){v.BaseAdapter.fn.init.call(this,b),this.type=g,this.defaultValue=this.defaultValue||(this.nullable?null:0),this.editor="input",this.attributes=a.extend({},this.attributes),this.attributes[c.attr("role")]="numerictextbox"}}),v.BooleanAdapter=v.BaseAdapter.extend({init:function(b){v.BaseAdapter.fn.init.call(this,b),this.type=h,this.defaultValue=this.defaultValue||(this.nullable?null:!1),this.editor="input",this.attributes=a.extend({},this.attributes),this.attributes[c.attr("role")]="switch"}}),v.DateAdapter=v.BaseAdapter.extend({init:function(b){v.BaseAdapter.fn.init.call(this,b),this.type=i,this.defaultValue=this.defaultValue||(this.nullable?null:new Date),this.editor="input",this.attributes=a.extend({},this.attributes),this.attributes[c.attr("role")]="datepicker"}}),v.StyleAdapter=v.BaseAdapter.extend({init:function(b){var c=this;v.BaseAdapter.fn.init.call(c,b),c.type=f,c.defaultValue=c.defaultValue||(c.nullable?null:""),c.editor=function(b,d){var e=a("<div/>").css({display:"table"}).appendTo(b),f=a("<span/>").css({display:"table-cell",width:"100%",paddingRight:"8px"}).appendTo(e),g=a("<input/>").addClass("k-textbox").css({width:"100%"}).attr(a.extend({},d.attributes,{"data-bind":"value: "+d.field})).appendTo(f);a("<button/>").text("...").addClass("k-button").css({display:"table-cell",minWidth:"40px",height:g.css("height"),margin:0}).appendTo(e).on(s,a.proxy(c.showDialog,c,d))}},showDialog:function(b){var d=this,e=a(r).data("kendoWindow");e instanceof c.ui.Window||(e=a(c.format(q,r.substr(1))).appendTo(document.body).kendoWindow({actions:["close"],modal:!0,resizable:!1,visible:!1}).data("kendoWindow"),e.element.on(s,".k-button",a.proxy(d.closeDialog,d,b,e))),e.title(b.title);var f='<div class="k-edit-form-container kj-style-edit-form"><div class="k-edit-label"><label for="title">Title</label></div><div data-container-for="title" class="k-edit-field"><input type="text" class="k-input k-textbox" name="title" data-bind="value:title"></div><div class="k-edit-label"><label for="start">Start</label></div><div data-container-for="start" class="k-edit-field"><span class="k-widget k-datetimepicker k-header"><span class="k-picker-wrap k-state-default"><input type="text" required="" data-type="date" data-role="datetimepicker" data-bind="value:start" data-validate="true" name="start" data-datecompare-msg="Start date should be before or equal to the end date" class="k-input" role="combobox" aria-expanded="false" aria-disabled="false" aria-readonly="false" style="width: 100%;"><span unselectable="on" class="k-select"><span unselectable="on" class="k-icon k-i-calendar" role="button">select</span><span unselectable="on" class="k-icon k-i-clock" role="button">select</span></span></span></span><span data-for="start" class="k-invalid-msg" style="display: none;"></span></div><div class="k-edit-label"><label for="end">End</label></div><div data-container-for="end" class="k-edit-field"><span class="k-widget k-datetimepicker k-header"><span class="k-picker-wrap k-state-default"><input type="text" required="" data-type="date" data-role="datetimepicker" data-bind="value:end" data-validate="true" name="end" data-datecompare-msg="End date should be after or equal to the start date" class="k-input" role="combobox" aria-expanded="false" aria-disabled="false" aria-readonly="false" style="width: 100%;"><span unselectable="on" class="k-select"><span unselectable="on" class="k-icon k-i-calendar" role="button">select</span><span unselectable="on" class="k-icon k-i-clock" role="button">select</span></span></span></span><span data-for="end" class="k-invalid-msg" style="display: none;"></span></div><div class="k-edit-label"><label for="percentComplete">Complete</label></div><div data-container-for="percentComplete" class="k-edit-field"><span class="k-widget k-numerictextbox"><span class="k-numeric-wrap k-state-default"><input type="text" class="k-formatted-value k-input" tabindex="0" aria-disabled="false" aria-readonly="false" style="display: inline-block;"><input type="text" name="percentComplete" required="required" min="0" max="1" step="0.01" data-type="number" data-bind="value:percentComplete" data-role="numerictextbox" role="spinbutton" class="k-input" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0" aria-disabled="false" aria-readonly="false" style="display: none;"><span class="k-select"><span unselectable="on" class="k-link"><span unselectable="on" class="k-icon k-i-arrow-n" title="Increase value">Increase value</span></span><span unselectable="on" class="k-link"><span unselectable="on" class="k-icon k-i-arrow-s" title="Decrease value">Decrease value</span></span></span></span></span><span data-for="percentComplete" class="k-invalid-msg" style="display: none;"></span></div><div class="k-edit-label"><label for="resources">Resources</label></div><div class="k-gantt-resources" style="display:none"></div><div data-container-for="resources" class="k-edit-field"><a href="#" class="k-button">Assign</a></div><div class="k-edit-buttons k-state-default"><a class="k-primary k-button" data-command="save" href="#">Save</a><a class="k-button" data-command="cancel" href="#">Cancel</a></div></div>';e.content(f),e.center().open()},closeDialog:function(b,d,e){if(e instanceof a.Event&&a(e.target)instanceof a){var f=a(e.target).attr(c.attr("command"));"save"===f&&a.noop(),d.close(),d.content("")}}}),v.NameAdapter=v.StringAdapter.extend({}),v.ValidationAdapter=v.BaseAdapter.extend({init:function(b){var c=this;switch(v.BaseAdapter.fn.init.call(c,b),c.type=f,b.solutionType){case f:case g:case h:case i:c.defaultValue=c.validators[b.solutionType][0].formula;break;default:c.defaultValue=c.validators["default"][0].formula}c.editor=function(b,d){var e=a("<div/>").css({display:"table"}).appendTo(b),f=a("<span/>").css({display:"table-cell",width:"100%",paddingRight:"8px"}).appendTo(e),g=a("<input/>").addClass("k-textbox").css({width:"100%"}).prop({readonly:!0}).appendTo(f);a("<button/>").text("...").addClass("k-button").css({display:"table-cell",minWidth:"40px",height:g.css("height"),margin:0}).appendTo(e).on(s,a.proxy(c.showDialog,c,d))}},showDialog:function(b){var d=this,e=a(r).data("kendoWindow");e instanceof c.ui.Window||(e=a(c.format(q,r.substr(1))).appendTo(document.body).kendoWindow({actions:["close"],modal:!0,resizable:!1,visible:!1}).data("kendoWindow"),e.element.on(s,".k-button",a.proxy(d.closeDialog,d,b,e))),e.title(b.title);var f='<div class="k-edit-form-container kj-validation-edit-form"><div class="kj-codemirror"></div><div class="k-edit-buttons k-state-default"><a class="k-primary k-button" data-command="save" href="#">Save</a><a class="k-button" data-command="cancel" href="#">Cancel</a></div></div>';e.content(f);var g=e.element.find(".kj-codemirror").get(0);g instanceof window.HTMLElement&&(e.codemirror=window.CodeMirror(g,{gutters:["CodeMirror-lint-markers"],lineNumbers:!0,lint:!0,mode:"javascript",value:d.defaultValue}),e.codemirror.getDoc().setValue(b.model.properties.get("validation")),e.codemirror.on("beforeChange",function(a,b){(0===b.from.line||b.from.line===a.display.renderedView.length-1||"+delete"===b.origin&&b.to.line===a.display.renderedView.length-1)&&b.cancel()}),e.bind("activate",function(){e.codemirror.refresh(),e.unbind("activate")}),e.center().open())},closeDialog:function(d,e,f){if(f instanceof a.Event&&a(f.target)instanceof a){var g=a(f.target).attr(c.attr("command"));"save"===g&&d.model.properties.set("validation",e.codemirror.getDoc().getValue()),e.close(),e.content(""),e.codemirror=b}},prerequisites:{string:"",number:"","boolean":"",date:"","default":""},validators:{string:[{name:"toUpperCase",formula:'function validate(value, solution) {\n	return typeof value === "string" && typeof solution === "string" &&\n		value.trim().toUpperCase() === solution.trim().toUpperCase();\n}'}],number:[{name:"float",formula:"function validate(value, solution) {\n	return parseFloat(value) === parseFloat(solution);\n}"},{name:"integer",formula:"function validate(value, solution) {\n	return parseInt(value, 10) === parseInt(solution, 10);\n}"},{name:"rounded to 2 decimals",formula:'function validate(value, solution) {\n	return typeof value === "number" && typeof solution === "number" && Math.round(value*100)/100 === Math.round(solution*100)/100;\n}'}],"boolean":[{name:"default",formula:'function validate(value, solution) {\n	return typeof value === "boolean" && typeof solution === "boolean" && value === solution;\n}'}],date:[{name:"date",formula:'function validate(value, solution) {\n	return typeof value === "date" && typeof solution === "date" && value.toDateString() === solution.toDateString();\n}'}],"default":[{name:"deepEqual",formula:""}]}}),v.ScoreAdapter=v.NumberAdapter.extend({});var w=d.Tool.extend({id:n,icon:"mouse_pointer",cursor:j,height:0,width:0,getHtml:b});d.tools.register(w);var x=d.Tool.extend({id:"label",icon:"document_orientation_landscape",cursor:k,templates:{"default":'<span style="#: attributes.style #">#: attributes.text #</span>'},height:100,width:300,attributes:{text:new v.StringAdapter({defaultValue:"Label"}),style:new v.StyleAdapter({defaultValue:"font-family: Georgia, serif; color: #FF0000;"})},getHtml:function(a){if(a instanceof d.PageComponent){var b=c.template(this.templates["default"]);return b(a)}},onResize:function(b,c){var e=a(b.currentTarget);if(e.is(o)&&c instanceof d.PageComponent){var f=e.find(">span");a.type(c.width)===g&&f.width(c.width),a.type(c.height)===g&&f.height(c.height);var h=parseInt(f.css("font-size"),10),i=f.clone().hide().css({position:p,height:"auto"}).width(c.width);for(e.after(i);i.height()<c.height;)h++,i.css("font-size",h);for(;i.height()>c.height;)h--,i.css("font-size",h);i.remove(),f.css("font-size",h),b.preventDefault(),b.stopPropagation()}}});d.tools.register(x);var y=d.Tool.extend({id:"image",icon:"painting_landscape",cursor:k,templates:{"default":'<img src="#: attributes.src #" alt="#: attributes.alt #">'},height:250,width:250,attributes:{src:new v.StringAdapter,alt:new v.StringAdapter},getHtml:function(a){if(a instanceof d.PageComponent){var b=c.template(this.templates["default"]);return b(a)}},onResize:function(b,c){var e=a(b.currentTarget);if(e.is(o)&&c instanceof d.PageComponent){var f=e.find(">img");a.type(c.width)===g&&f.width(c.width),a.type(c.height)===g&&f.height(c.height),b.preventDefault(),b.stopPropagation()}}});d.tools.register(y);var z=d.Tool.extend({id:"textbox",icon:"text_field",cursor:k,templates:{"default":'<input type="text" style="#: attributes.style #" data-#= ns #bind="value: #: properties.name #">'},height:100,width:300,attributes:{style:new v.StyleAdapter},properties:{name:new v.NameAdapter({title:"Name"}),description:new v.StringAdapter({title:"Description"}),solution:new v.StringAdapter({title:"Solution"}),validation:new v.ValidationAdapter({title:"Validation",solutionType:f}),success:new v.ScoreAdapter({title:"Success"}),failure:new v.ScoreAdapter({title:"Failure"}),omit:new v.ScoreAdapter({title:"Omit"})},getHtml:function(b){if(b instanceof d.PageComponent){var e=c.template(this.templates["default"]);return e(a.extend(b,{ns:c.ns}))}},onResize:function(b,c){var e=a(b.currentTarget);if(e.is(o)&&c instanceof d.PageComponent){var f=e.find(">input");a.type(c.width)===g&&f.width(c.width),a.type(c.height)===g&&(f.height(c.height),f.css("font-size",Math.floor(.75*c.height))),b.preventDefault(),b.stopPropagation()}}});d.tools.register(z);var A=d.Tool.extend({id:"button",icon:"button",cursor:k,templates:{"default":'<a class="k-toggle-button k-button" style="#: attributes.style #">#: attributes.text #</a><input type="hidden" data-#= ns #bind="value: #: properties.name #">'},height:100,width:300,attributes:{style:new v.StyleAdapter,activeStyle:new v.StyleAdapter,text:new v.StringAdapter({defaultValue:"Button"})},properties:{name:new v.NameAdapter({title:"Name"}),description:new v.StringAdapter({title:"Description"}),solution:new v.BooleanAdapter({title:"Solution"}),validation:new v.ValidationAdapter({title:"Validation",solutionType:h}),success:new v.ScoreAdapter({title:"Success"}),failure:new v.ScoreAdapter({title:"Failure"}),omit:new v.ScoreAdapter({title:"Omit"})},getHtml:function(b){if(b instanceof d.PageComponent){var e=c.template(this.templates["default"]);return e(a.extend(b,{ns:c.ns}))}},addEvents:function(){},removeEvents:function(){},onResize:function(b,c){var e=a(b.currentTarget);if(e.is(o)&&c instanceof d.PageComponent){var f=e.find(">a");a.type(c.width)===g&&f.width(c.width-14),a.type(c.height)===g&&(f.height(c.height-4),f.css("font-size",Math.floor(.6*c.height))),b.preventDefault(),b.stopPropagation()}}});d.tools.register(A);var B=d.Tool.extend({id:"checkbox",icon:"checkbox",cursor:k,templates:{"default":'<div><input id="#: properties.name #" type="checkbox" style="#: attributes.checkboxStyle #" data-#= ns #bind="checked: #: properties.name #"><label for="#: properties.name #" style="#: attributes.labelStyle #">#: attributes.text #</label></div>'},height:60,width:500,attributes:{checkboxStyle:new v.StyleAdapter,labelStyle:new v.StyleAdapter,text:new v.StringAdapter({defaultValue:"text"})},properties:{name:new v.NameAdapter({title:"Name"}),description:new v.StringAdapter({title:"Description"}),solution:new v.BooleanAdapter({title:"Solution"}),validation:new v.ValidationAdapter({title:"Validation",solutionType:h}),success:new v.ScoreAdapter({title:"Success"}),failure:new v.ScoreAdapter({title:"Failure"}),omit:new v.ScoreAdapter({title:"Omit"})},getHtml:function(b){if(b instanceof d.PageComponent){var e=c.template(this.templates["default"]);return e(a.extend(b,{ns:c.ns}))}},onResize:function(b,c){var e=a(b.currentTarget);if(e.is(o)&&c instanceof d.PageComponent){var f=e.find(">div"),g=f.clone().hide().css({position:"absolute",height:"auto",width:"auto"});e.after(g);for(var h=g.find('input[type="checkbox"]'),i=g.find("label"),j=parseInt(i.css("font-size"));g.width()<=c.width&&g.height()<=c.height;)j++,i.css("font-size",j),h.css({height:2*j/3,width:2*j/3});for(;g.width()>c.width||g.height()>c.height;)j--,i.css("font-size",j),h.css({height:2*j/3,width:2*j/3});g.remove(),f.find("label").css("font-size",j),f.find('input[type="checkbox"]').css({height:2*j/3,width:2*j/3}),b.preventDefault(),b.stopPropagation()}}});d.tools.register(B);var C=d.Tool.extend({id:"quiz",icon:"radio_button_group",cursor:k,templates:{"default":'<div><div><input id="#: properties.name #_1" type="radio" name="#: properties.name #" style="#: attributes.radioStyle #" value="1" data-#= ns #bind="checked: #: properties.name #"><label for="#: properties.name #_1" style="#: attributes.labelStyle #">#: attributes.text1 #</label></div><div><input id="#: properties.name #_2" type="radio" name="#: properties.name #" style="#: attributes.radioStyle #" value="2" data-#= ns #bind="checked: #: properties.name #"><label for="#: properties.name #_2" style="#: attributes.labelStyle #">#: attributes.text2 #</label></div><div><input id="#: properties.name #_3" type="radio" name="#: properties.name #" style="#: attributes.radioStyle #" value="3" data-#= ns #bind="checked: #: properties.name #"><label for="#: properties.name #_3" style="#: attributes.labelStyle #">#: attributes.text3 #</label></div><div><input id="#: properties.name #_4" type="radio" name="#: properties.name #" style="#: attributes.radioStyle #" value="4" data-#= ns #bind="checked: #: properties.name #"><label for="#: properties.name #_4" style="#: attributes.labelStyle #">#: attributes.text4 #</label></div></div>'},height:300,width:500,attributes:{labelStyle:new v.StyleAdapter,radioStyle:new v.StyleAdapter,text1:new v.StringAdapter({defaultValue:"text1"}),text2:new v.StringAdapter({defaultValue:"text2"}),text3:new v.StringAdapter({defaultValue:"text3"}),text4:new v.StringAdapter({defaultValue:"text4"})},properties:{name:new v.NameAdapter({title:"Name"}),description:new v.StringAdapter({title:"Description"}),solution:new v.StringAdapter({title:"Solution"}),validation:new v.ValidationAdapter({title:"Validation",solutionType:f}),success:new v.ScoreAdapter({title:"Success"}),failure:new v.ScoreAdapter({title:"Failure"}),omit:new v.ScoreAdapter({title:"Omit"})},getHtml:function(b){if(b instanceof d.PageComponent){var e=c.template(this.templates["default"]);return e(a.extend(b,{ns:c.ns}))}},onResize:function(b,c){var e=a(b.currentTarget);if(e.is(o)&&c instanceof d.PageComponent){var f=e.find(">div"),g=f.clone().hide().css({position:"absolute",height:"auto",width:"auto"});e.after(g);for(var h=g.find('input[type="radio"]'),i=g.find("label"),j=parseInt(i.css("font-size"));g.width()<=c.width&&g.height()<=c.height;)j++,i.css("font-size",j),h.css({height:2*j/3,width:2*j/3});for(;g.width()>c.width||g.height()>c.height;)j--,i.css("font-size",j),h.css({height:2*j/3,width:2*j/3});g.remove(),f.find("label").css("font-size",j),f.find('input[type="radio"]').css({height:2*j/3,width:2*j/3}),b.preventDefault(),b.stopPropagation()}}});d.tools.register(C)}(jQuery),window.kidoju},"function"==typeof define&&define.amd?define:function(a,b){"use strict";b()}),function(a,b){"use strict";b(["./vendor/kendo/kendo.binder"],a)}(function(){"use strict";return function(a){var b=window.kendo,c=b.data,d=c.binders,e=c.Binder,f=(b.ui,"change");d.widget.properties=e.extend({init:function(b,c,d){e.fn.init.call(this,b.element[0],c,d),this.widget=b,this._change=a.proxy(this.change,this),this.widget.bind(f,this._change)},change:function(){this.bindings.properties.set(this.widget.properties())},refresh:function(){this.widget.properties(this.bindings.properties.get())},destroy:function(){this.widget.unbind(f,this._change)}})}(jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(a,b){"use strict";b()}),function(a,b){"use strict";b(["./vendor/kendo/kendo.core","./vendor/kendo/kendo.data"],a)}(function(){"use strict";return function(a){function b(b){window.app&&window.app.DEBUG&&window.console&&a.isFunction(window.console.log)&&window.console.log("kidoju.widgets.designbar: "+b)}var c=window.kendo,d=(c.data,c.ui.Widget),e="k-widget kj-explorer",f=d.extend({init:function(a,c){var e=this;d.fn.init.call(this,a,c),b("widget initialized"),e._layout()},options:{name:"Designbar"},_layout:function(){var b=this;a(b.element).html(b.options.name)},_clear:function(){var b=this;a(b.element).find("*").off(),a(b.element).off().empty().removeClass(e)},destroy:function(){var a=this;d.fn.destroy.call(a),a._clear(),c.destroy(a.element)}});c.ui.plugin(f)}(jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(a,b){"use strict";b()}),function(a,b){"use strict";b(["./kidoju.data","./kidoju.tools"],a)}(function(){"use strict";return function(a,b){function c(b){window.app&&window.app.DEBUG&&window.console&&a.isFunction(window.console.log)&&window.console.log("kidoju.widgets.explorer: "+b)}function d(b){return a.type(b)===h&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(b)}var e=window.kendo,f=(e.data,e.ui.Widget),g=window.kidoju,h="string",i="number",j=null,k="change",l="click",m="dataBinding",n="dataBound",o="mouseenter",p="mouseleave",q="focus",r="blur",s="select",t=".kendoExplorer",u="k-widget k-group kj-explorer",v="k-state-hover",w="k-state-focused",x="k-state-selected",y=e.attr("uid"),z="li.kj-item["+y+"]",A="li.kj-item["+y+'="{0}"]',B="aria-selected",C=f.extend({init:function(a,b){var d=this;f.fn.init.call(this,a,b),c("widget initialized"),d._templates(),d._layout(),d._dataSource()},options:{name:"Explorer",index:0,id:j,autoBind:!0,itemTemplate:'<li data-uid="#= uid #" tabindex="-1" unselectable="on" role="option" class="k-item kj-item"><span class="k-in"><img class="k-image kj-image" alt="#= tool #" src="#= icon #">#= tool #</span></li>',iconPath:"./styles/images/",messages:{empty:"No item to display"}},setOptions:function(a){f.fn.setOptions.call(this,a)},events:[k,m,n,s],index:function(c){var d,e=this;if(c===b)return d=e.dataSource.getByUid(e._selectedUid),d instanceof g.PageComponent?e.dataSource.indexOf(d):-1;if(a.type(c)!==i||c%1!==0)throw new TypeError;if(0>c||c>0&&c>=e.length())throw new RangeError;d=e.dataSource.at(c),e.value(d)},id:function(c){var d,e=this;if(c!==b){if(a.type(c)!==i&&a.type(c)!==h)throw new TypeError;d=e.dataSource.get(c),e.value(d)}else if(d=e.dataSource.getByUid(e._selectedUid),d instanceof g.PageComponent)return d[d.idField]},value:function(a){var e=this;if(a===j)e._selectedUid!==j&&(e._selectedUid=j,c("selected component uid set to null"),e._toggleSelection(),e.trigger(k,{index:b,value:j}));
else{if(a===b)return e._selectedUid===j?j:e.dataSource.getByUid(e._selectedUid);if(!(a instanceof g.PageComponent))throw new TypeError;if(a.uid!==e._selectedUid&&d(a.uid)){var f=e.dataSource.indexOf(a);f>-1&&(e._selectedUid=a.uid,c("selected component uid set to "+a.uid),e._toggleSelection(),e.trigger(k,{index:f,value:a}))}}},length:function(){return this.dataSource instanceof g.PageComponentCollectionDataSource?this.dataSource.total():-1},items:function(){return this.ul[0].children},_templates:function(){var a=this;a.itemTemplate=e.template(a.options.itemTemplate)},setDataSource:function(a){this.options.dataSource=a,this._dataSource()},_dataSource:function(){var b=this;b.dataSource instanceof g.PageComponentCollectionDataSource&&b._refreshHandler&&b.dataSource.unbind(k,b._refreshHandler),b.options.dataSource!==j&&(b.dataSource=g.PageComponentCollectionDataSource.create(b.options.dataSource),b._refreshHandler=a.proxy(b.refresh,b),b.dataSource.bind(k,b._refreshHandler),b.options.autoBind&&b.dataSource.fetch())},_layout:function(){var b=this;b.wrapper=b.element,b.ul=b.element.find("ul.k-list"),b.ul.length||(b.ul=a('<ul tabindex="-1" unselectable="on" role="listbox" class="k-list k-reset" />').appendTo(b.element)),b.element.addClass(u).attr("role","listbox").on(o+t+" "+p+t,z,b._toggleHover).on(q+t+" "+r+t,z,b._toggleFocus).on(l+t,z,a.proxy(b._click,b)),e.notify(b)},_addItem:function(b){var c=this;if(c.ul instanceof a&&c.ul.length&&b instanceof g.PageComponent&&0===c.ul.find(e.format(A,b.uid)).length){var d=g.tools[b.tool];if(d instanceof g.Tool){var f=c.itemTemplate({uid:b.uid,tool:b.tool,icon:c.options.iconPath+d.icon+".svg"});c.ul.append(f)}}},_removeItemByUid:function(b){if(this.ul instanceof a&&this.ul.length){var c=this.ul.find(e.format(A,b));c.off().remove()}},refresh:function(c){var d=this;if(c&&c.action===b&&d.trigger(m),c===b||c.action===b){var f=[];c===b&&d.dataSource instanceof g.PageCollectionDataSource?f=d.dataSource.data():c&&c.items instanceof e.data.ObservableArray&&(f=c.items),a.each(d.element.find(z),function(b,c){d._removeItemByUid(a(c).attr(y))}),a.each(f,function(a,b){d._addItem(b)})}else"add"===c.action&&a.isArray(c.items)&&c.items.length?a.each(c.items,function(a,b){d._addItem(b),d.trigger(k,{action:c.action,value:b})}):"remove"===c.action&&a.isArray(c.items)&&c.items.length?a.each(c.items,function(a,b){d._removeItemByUid(b.uid),d.trigger(k,{action:c.action,value:b})}):"itemchange"===c.action&&a.noop();d._toggleSelection(),c&&c.action===b&&d.trigger(n)},_toggleSelection:function(){this.ul.find(z).removeClass(x).removeProp(B),this.ul.find(e.format(A,this._selectedUid)).addClass(x).prop(B,!0)},_toggleHover:function(b){b instanceof a.Event&&a(b.currentTarget).toggleClass(v,b.type===o)},_toggleFocus:function(b){b instanceof a.Event&&a(b.currentTarget).toggleClass(w,b.type===q)},_click:function(b){if(b instanceof a.Event){b.preventDefault();var c=a(b.currentTarget);if(!c.is("."+x)){var d=this.dataSource.getByUid(c.attr(e.attr("uid")));this.value(d)}}},_clear:function(){var a=this,b=a.element;e.unbind(b),b.find("*").off(),b.off(t).empty().removeClass(u)},destroy:function(){var a=this;f.fn.destroy.call(a),a._clear(),a.setDataSource(j)}});e.ui.plugin(C)}(jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(a,b){"use strict";b()}),function(a,b){"use strict";b(["./kidoju.data","./kidoju.tools"],a)}(function(){"use strict";return function(a,b){function c(b){window.app&&window.app.DEBUG&&window.console&&a.isFunction(window.console.log)&&window.console.log("kidoju.widgets.navigation: "+b)}function d(b){return a.type(b)===j&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(b)}var e=window.kendo,f=(e.data,e.ui.Widget),g=window.kidoju,h=null,i="number",j="string",k="change",l="click",m="dataBinding",n="dataBound",o="mouseenter",p="mouseleave",q="focus",r="blur",s="select",t=".kendoNavigation",u="k-widget k-group kj-navigation",v="k-state-hover",w="k-state-focused",x="k-state-selected",y="kj-hint",z=e.attr("uid"),A="div.kj-item["+z+"]",B="div.kj-item["+z+'="{0}"]',C="aria-selected",D=f.extend({init:function(a,b){var d=this;f.fn.init.call(this,a,b),d._templates(),d._layout(),d._addSorting(),d._dataSource(),c("widget initialized")},options:{name:"Navigation",autoBind:!0,itemTemplate:'<div data-#: ns #uid="#: uid #" class="kj-item" role="option" aria-selected="false"><div data-#: ns #role="stage"></div></div>',pageWidth:1024,pageHeight:768,selectionBorder:10,pageSpacing:20,menuIcon:"calibration_mark.svg"},events:[k,m,n,s],index:function(c){var d,e=this;if(c===b)return d=e.dataSource.getByUid(e._selectedUid),d instanceof g.Page?e.dataSource.indexOf(d):-1;if(a.type(c)!==i||c%1!==0)throw new TypeError;if(0>c||c>0&&c>=e.length())throw new RangeError;d=e.dataSource.at(c),e.value(d)},id:function(c){var d,e=this;if(c!==b){if(a.type(c)!==j&&a.type(c)!==i)throw new TypeError;d=e.dataSource.get(c),e.value(d)}else if(d=e.dataSource.getByUid(e._selectedUid),d instanceof g.Page)return d[d.idField]},value:function(a){var e=this;if(a===h)e._selectedUid!==h&&(e._selectedUid=h,c("selected page uid set to null"),e._toggleSelection(),e.trigger(k,{index:b,value:a}));else{if(a===b)return e._selectedUid===h?h:e.dataSource.getByUid(e._selectedUid);if(!(a instanceof g.Page))throw new TypeError;if(a.uid!==e._selectedUid&&d(a.uid)){var f=e.dataSource.indexOf(a);f>-1&&(e._selectedUid=a.uid,c("selected page uid set to "+a.uid),e._toggleSelection(),e.trigger(k,{index:f,value:a}))}}},length:function(){return this.dataSource instanceof g.PageCollectionDataSource?this.dataSource.total():-1},items:function(){return this.element[0].children},height:function(b){var c=this;if(!b)return c.options.height;if(a.type(b)!==i)throw new TypeError;if(0>b)throw new RangeError;b!==c.options.height&&(c.options.height=b)},width:function(b){var c=this;if(!b)return c.options.width;if(a.type(b)!==i)throw new TypeError;if(0>b)throw new RangeError;b!==c.options.width&&(c.options.width=b)},_templates:function(){this._itemTemplate=e.template(this.options.itemTemplate)},setDataSource:function(a){this.options.dataSource=a,this._dataSource()},_dataSource:function(){var b=this;b.dataSource instanceof g.PageCollectionDataSource&&b._refreshHandler&&b.dataSource.unbind(k,b._refreshHandler),b.options.dataSource!==h&&(b.dataSource=g.PageCollectionDataSource.create(b.options.dataSource),b._refreshHandler=a.proxy(b.refresh,b),b.dataSource.bind(k,b._refreshHandler),b.options.autoBind&&b.dataSource.fetch())},_layout:function(){var b=this;b.wrapper=b.element,b.element.addClass(u).attr("role","listbox").on(o+t+" "+p+t,A,b._toggleHover).on(q+t+" "+r+t,A,b._toggleFocus).on(l+t,A,a.proxy(b._click,b)),e.notify(b)},_addSorting:function(){var b=this;b.element.kendoSortable({hint:function(a){return a.clone().addClass(y)},change:function(b){"sort"===b.action&&b.item instanceof a&&a.type(b.oldIndex)===i&&a.type(b.newIndex)===i&&a.noop()}})},_addItem:function(b){var c=this,d=c.element;if(b instanceof g.Page&&0===d.find(e.format(B,b.uid)).length){var f=a(c._itemTemplate({uid:b.uid,ns:e.ns})).css({boxSizing:"border-box",position:"relative",padding:parseInt(c.options.selectionBorder,10),margin:parseInt(c.options.pageSpacing,10)-parseInt(c.options.selectionBorder,10)});f.append('<div style="position:absolute; top: 10px; left: 10px; height: 20px; width: 20px; background-color: black;"></div>'),d.append(f),f.find(e.roleSelector("stage")).kendoStage({mode:e.ui.Stage.fn.modes.thumbnail,dataSource:b.components,scale:c._getStageScale()})}},_removeItemByUid:function(a){var b=this.element.find(e.format(B,a));e.destroy(b),b.off().remove()},refresh:function(c){var d=this;if(c&&c.action===b&&d.trigger(m),c===b||c.action===b){var f=[];c===b&&d.dataSource instanceof g.PageCollectionDataSource?f=d.dataSource.data():c&&c.items instanceof e.data.ObservableArray&&(f=c.items),a.each(d.element.find(A),function(b,c){d._removeItemByUid(a(c).attr(z))}),a.each(f,function(a,b){d._addItem(b)})}else"add"===c.action&&a.isArray(c.items)&&c.items.length?a.each(c.items,function(a,b){d._addItem(b),d.trigger(k,{action:c.action,value:b})}):"remove"===c.action&&a.isArray(c.items)&&c.items.length?a.each(c.items,function(a,b){d._removeItemByUid(b.uid),d.trigger(k,{action:c.action,value:b})}):"itemchange"===c.action&&a.noop();d._toggleSelection(),d.resize(),c&&c.action===b&&d.trigger(n)},_toggleSelection:function(){this.element.find(A).removeClass(x).removeProp(C),this.element.find(e.format(B,this._selectedUid)).addClass(x).prop(C,!0)},_getStageScale:function(){var a=(this.element.innerWidth()-2*parseInt(this.options.pageSpacing,10)-2*parseInt(this.options.selectionBorder,10))/parseInt(this.options.pageWidth,10);return 0>a&&(a=0),a},resize:function(){var b=this,c=b.element,d=b._getStageScale();c.find(A).width(d*parseInt(b.options.pageWidth,10)).height(d*parseInt(b.options.pageHeight,10));for(var f=c.find(e.roleSelector("stage")),g=0;g<f.length;g++)a(f[g]).data("kendoStage").scale(d)},_toggleHover:function(b){b instanceof a.Event&&a(b.currentTarget).toggleClass(v,b.type===o)},_toggleFocus:function(b){b instanceof a.Event&&a(b.currentTarget).toggleClass(w,b.type===q)},_click:function(b){if(b instanceof a.Event){b.preventDefault();{var c=a(b.currentTarget);c.closest(e.roleSelector("navigation"))}if(!c.is("."+x)){var d=this.dataSource.getByUid(c.attr(e.attr("uid")));this.value(d)}}},_clear:function(){var a=this;e.unbind(a.element),a.element.find("*").off(),a.element.off().empty().removeClass(u)},destroy:function(){var a=this;f.fn.destroy.call(a),a._clear(),a.setDataSource(h),e.destroy(a.element)}});e.ui.plugin(D)}(jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(a,b){"use strict";b()}),function(a,b){"use strict";b(["./kidoju.data","./kidoju.tools"],a)}(function(){"use strict";return function(a,b){function c(b){window.app&&window.app.DEBUG&&window.console&&a.isFunction(window.console.log)&&window.console.log("kidoju.widgets.playbar: "+b)}function d(a,b,c,d,e){return a({idx:b,text:c,ns:k.ns,numeric:d,title:e||""})}function e(a,b,c,d){return a({className:b.substring(1),text:c,wrapClassName:d||""})}function f(a,b,c,d){a.find(b).parent().attr(k.attr("index"),c).attr("tabindex",-1).toggleClass("k-state-disabled",d)}function g(a,b){f(a,x,0,0>=b)}function h(a,b){f(a,z,Math.max(0,b-1),0>=b)}function i(a,b,c){f(a,A,Math.min(c-1,b+1),b>=c-1)}function j(a,b,c){f(a,y,c-1,b>=c-1)}var k=window.kendo,l=(k.data,k.ui.Widget),m=window.kidoju,n="string",o="number",p=null,q="change",r="click",s="dataBinding",t="dataBound",u="keydown",v=".kendoPlayBar",w="k-widget k-pager-wrap kj-playbar",x=".k-i-seek-w",y=".k-i-seek-e",z=".k-i-arrow-w",A=".k-i-arrow-e",B=".k-i-tick",C=l.extend({init:function(a,b){var d=this;b=b||{},l.fn.init.call(d,a,b),c("widget initialized"),d._selectedIndex=d.options.index||0,d._templates(),d._layout(),d._dataSource()},options:{name:"PlayBar",iconTemplate:'<a href="\\#" title="#:text#" class="k-link k-pager-nav #= wrapClassName #"><span class="k-icon #= className #">#:text#</span></a>',selectTemplate:'<li><span class="k-state-selected">#: text #</span></li>',linkTemplate:'<li><a tabindex="-1" href="\\#" class="k-link" data-#=ns#index="#=idx#" #if (title !== "") {# title="#=title#" #}#>#:text#</a></li>',buttonCount:10,autoBind:!0,index:0,numeric:!0,info:!0,input:!1,previousNext:!0,tick:!0,refresh:!0,messages:{empty:"No page to display",page:"Page",of:"of {0}",first:"Go to the first page",previous:"Go to the previous page",next:"Go to the next page",last:"Go to the last page",tick:"Submit and check results",refresh:"Refresh",morePages:"More pages"}},events:[q,r,s,t],index:function(d){var e=this;if(d===b)return e._selectedIndex;if(a.type(d)!==o||d%1!==0)throw new TypeError;if(0>d||d>0&&d>=e.length())throw new RangeError;if(d!==e._selectedIndex){var f=e.dataSource.at(d);f instanceof m.Page&&(e._selectedIndex=d,c("selected index set to "+d),e.refresh(),e.trigger(q,{index:d,value:f}))}},id:function(c){var d,e=this;if(c!==b){if(a.type(c)!==n&&a.type(c)!==o)throw new TypeError;if(d=e.dataSource.get(c),d!==b){var f=e.dataSource.indexOf(d);f>=0&&e.index(f)}}else if(d=e.dataSource.at(e._selectedIndex),d instanceof m.Page)return d[d.idField]},value:function(c){var d=this;if(c===p)a.noop();else{if(c===b)return d.dataSource.at(d._selectedIndex);if(!(c instanceof m.Page))throw new TypeError;var e=d.dataSource.indexOf(c);e>-1&&d.index(e)}},length:function(){return this.dataSource instanceof m.PageCollectionDataSource?this.dataSource.total():-1},items:function(){return this.element.find("ul.k-pager-numbers")[0].children},_templates:function(){var a=this;a.iconTemplate=k.template(a.options.iconTemplate),a.linkTemplate=k.template(a.options.linkTemplate),a.selectTemplate=k.template(a.options.selectTemplate)},setDataSource:function(a){this.options.dataSource=a,this._dataSource()},_dataSource:function(){var b=this;b.dataSource instanceof m.PageCollectionDataSource&&b._refreshHandler&&b.dataSource.unbind(q,b._refreshHandler),b.options.dataSource!==p&&(b.dataSource=m.PageCollectionDataSource.create(b.options.dataSource),b._refreshHandler=a.proxy(b.refresh,b),b.dataSource.bind(q,b._refreshHandler),b.options.autoBind&&b.dataSource.fetch())},_layout:function(){var b=this,c=b.element,d=b.options,f=b.index(),l=b.length();d.previousNext&&(c.find(x).length||(c.append(e(b.iconTemplate,x,d.messages.first,"k-pager-first")),g(c,f,l)),c.find(z).length||(c.append(e(b.iconTemplate,z,d.messages.previous,"k-pager-previous")),h(c,f,l))),d.numeric&&(b.list=c.find(".k-pager-numbers"),b.list.length||(b.list=a('<ul class="k-pager-numbers k-reset" />').appendTo(c))),d.input&&(c.find(".k-pager-input").length||c.append('<span class="k-pager-input k-label">'+d.messages.page+'<input class="k-textbox">'+k.format(d.messages.of,l)+"</span>"),c.on(u+v,".k-pager-input input",a.proxy(b._keydown,b))),d.previousNext&&(c.find(A).length||(c.append(e(b.iconTemplate,A,d.messages.next,"k-pager-next")),i(c,f,l)),c.find(y).length||(c.append(e(b.iconTemplate,y,d.messages.last,"k-pager-last")),j(c,f,l))),d.tick&&c.append(e(b.iconTemplate,B,d.messages.tick,"k-pager-tick")),d.refresh&&(c.find(".k-pager-refresh").length||c.append('<a href="#" class="k-pager-refresh k-link" title="'+d.messages.refresh+'"><span class="k-icon k-i-refresh">'+d.messages.refresh+"</span></a>"),c.on(r+v,".k-pager-refresh",a.proxy(b._refreshClick,b))),d.info&&(c.find(".k-pager-info").length||c.append('<span class="k-pager-info k-label" />')),c.addClass(w).on(r+v,"a",a.proxy(b._navClick,b)),b.wrapper=b.element,k.notify(b)},refresh:function(a){var c,e,f=this,l=(f.element,f.options),m=f.index(),n=f.length(),o=0,p="";if(!a||"itemchange"!==a.action){if(a&&a.action===b&&f.trigger(s),l.numeric){for(m>l.buttonCount-1&&(o=m-m%l.buttonCount),e=Math.min(o+l.buttonCount-1,n-1),o>0&&(p+=d(f.linkTemplate,o-1,"...",!1,l.messages.morePages)),c=o;e>=c;c++)p+=d(c===m?f.selectTemplate:f.linkTemplate,c,c+1,!0);n-1>e&&(p+=d(f.linkTemplate,c,"...",!1,l.messages.morePages)),""===p&&(p=f.selectTemplate({text:0})),f.list.html(p)}l.info&&(p=n>0?l.messages.page+" "+(m+1)+" "+k.format(l.messages.of,n):l.messages.empty,f.element.find(".k-pager-info").html(p)),l.input&&f.element.find(".k-pager-input").html(l.messages.page+'<input class="k-textbox">'+k.format(l.messages.of,n)).find("input").val(m+1).attr("disabled",1>n).toggleClass("k-state-disabled",1>n),l.previousNext&&(g(f.element,m,n),h(f.element,m,n),i(f.element,m,n),j(f.element,m,n)),a&&a.action===b&&f.trigger(t,{addedDataItems:[]})}},_keydown:function(b){if(b instanceof a.Event&&b.keyCode===k.keys.ENTER){var c=this.element.find(".k-pager-input").find("input"),d=parseInt(c.val(),10);(isNaN(d)||1>d||d>this.length())&&(d=this.index()+1),c.val(d),this.index(d-1)}},_refreshClick:function(b){b instanceof a.Event&&(b.preventDefault(),this.dataSource.read())},_navClick:function(b){if(b instanceof a.Event){b.preventDefault();var c=a(b.currentTarget);if(!c.is(".k-state-disabled")){var d=parseInt(c.attr(k.attr("index")),10);isNaN(d)?c.hasClass("k-pager-tick")&&this.trigger(r):this.index(d)}}},_clear:function(){var b=this;a(b.element).find("*").off(),a(b.element).off().empty().removeClass(w)},destroy:function(){var a=this;l.fn.destroy.call(a),a._clear(),a.setDataSource(p),k.destroy(a.element)}});k.ui.plugin(C)}(jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(a,b){"use strict";b()}),function(a,b){"use strict";b(["./kidoju.data","./kidoju.tools","./vendor/kendo/kendo.numerictextbox","./vendor/kendo/kendo.datepicker","./vendor/kendo/kendo.mobile.switch"],a)}(function(){"use strict";return function(a,b){var c=window.kendo,d=c.ui,e=d.Widget,f=window.kidoju=window.kidoju||{},g="object",h="string",i="number",j="boolean",k="date",l=null,m=/^_/,n="tbody",o='td[role="gridcell"]',p=e.extend({init:function(a,b){var c=this;e.fn.init.call(this,a,b),r.log("widget initialized"),c.wrapper=c.element,c._layout(),c._addValidator(),c.refresh()},options:{name:"PropertyGrid",value:l,rows:l,validation:l,templates:{row:'<tr role="row"><td role="gridcell">#: title #</td><td role="gridcell"></td></tr>',altRow:'<tr class="k-alt" role="row"><td role="gridcell">#: title #</td><td role="gridcell"></td></tr>'},messages:{property:"Property",value:"Value"}},value:function(c){var d=this;if(null===c)null!==d.options.value&&(d.options.value=null,d.refresh());else{if(c===b)return d.options.value;if(a.type(c)!==g)throw new TypeError("Properties should be an object");c!==d.options.value&&(d.options.value=c,d.refresh())}},rows:function(c){var d=this;if(c===b)return d.options.rows;if(!a.isArray(c))throw new TypeError("Rows should be an object");c!==d.options.rows&&(d.options.rows=c,d.refresh())},_layout:function(){var a=this;a.wrapper=a.element,a.element.addClass("k-grid k-widget").append('<div class="k-grid-header" style="padding-right: 17px;"><div class="k-grid-header-wrap"><table role="grid"><colgroup><col><col></colgroup><thead role="rowgroup"><tr role="row"><th role="columnheader" class="k-header">'+a.options.messages.property+'</th><th role="columnheader" class="k-header">'+a.options.messages.value+"</th></tr></thead></table></div></div>").append('<div class="k-grid-content"><table role="grid" style="height: auto;"><colgroup><col><col></colgroup><tbody role="rowgroup"></tbody></table></div>')},refresh:function(){var b=this,d=b.value(),e=a(b.element).find(n).first();if(c.unbind(e),c.destroy(e),e.find("*").off(),e.empty(),a.type(d)===g){for(var f=c.template(b.options.templates.row),h=c.template(b.options.templates.altRow),i=b._buildRows(),j=0,k=0;k<i.length;k++){var l=i[k];if(l){var m=(k-j)%2===1?h:f;e.append(m({title:l.title}));var p=e.find(o).last(),q=a.extend({},l,{model:d});l.editor(p,q)}else j++}c.bind(e,d,c.ui,c.mobile.ui)}},_buildRows:function(){function c(d,h,i){var j=d.fields,k=d.defaults;for(var l in d)if(d.hasOwnProperty(l)&&!m.test(l)&&!a.isFunction(d[l])&&(!f||h.hasOwnProperty(l)))if(a.type(d[l])===g)c(d[l],h[l]||{},0===i.length?l:i+"."+l);else{var n={attributes:f&&h[l]&&h[l].attributes?h[l].attributes:b,editable:j&&j[l]&&j[l].editable===!1?!1:!0,editor:f&&h[l]&&h[l].editor?h[l].editor:b,field:0===i.length?l:i+"."+l,format:f&&h[l]&&h[l].format?h[l].format:b,template:f&&h[l]&&h[l].template?h[l].template:b,title:f&&h[l]&&h[l].title?h[l].title:r.formatTitle(l),type:r.getType(j&&j[l],k&&k[l],d[l])};if(j&&j[l]&&j[l].validation){var o={required:j[l].validation.required?!0:b,min:j[l].validation.min,max:j[l].validation.max,maxlength:j[l].validation.maxlength,step:j[l].validation.step,pattern:j[l].validation.pattern,type:j[l].validation.type};n.attributes=a.extend({},n.attributes,o)}r.optimizeEditor(n),n.type&&(f?e[h[l]._index]=n:e.push(n))}}var d=this,e=[],f=a.isArray(d.options.rows);return c(d.value(),r.hash(d.options.rows),""),e},validation:function(c){var d=this;if(c===b)return d.options.validation;if(c!==l&&!a.isPlainObject(c))throw new TypeError("validation is not a nullable object");c!==d.options.validation&&(d.options.validation=c,d._removeValidator(),d._addValidator())},_addValidator:function(){var a=this;a._validator instanceof c.ui.Validator||(a._validator=a.element.kendoValidator(a.options.validation).data("kendoValidator"))},_removeValidator:function(){var a=this;a._validator instanceof c.ui.Validator&&a._validator.destroy()},errors:function(){var a=this;return a._validator instanceof c.ui.Validator?a._validator.errors():void 0},hideMessages:function(){var a=this;return a._validator instanceof c.ui.Validator?a._validator.hideMessages():void 0},validate:function(){var a=this;return a._validator instanceof c.ui.Validator?a._validator.validate():void 0},validateInput:function(a){var b=this;return b._validator instanceof c.ui.Validator?b._validator.validateInput(a):void 0},_clear:function(){var a=this;a._removeValidator(),c.unbind(a.element),c.destroy(a.element),a.element.find("*").off(),a.element.off().empty().removeClass("k-widget k-grid")},destroy:function(){var a=this;a._clear(),e.fn.destroy.call(this)}});d.plugin(p);var q=f.editors={span:function(b,c){a("<span/>").attr(a.extend({},c.attributes,r.getTextBinding(c.field))).appendTo(b)},input:function(d,e){e&&e.attributes&&e.attributes[c.attr("role")]===b&&([b,"text","email","search","tel","url"].indexOf(e.attributes.type)>-1?e.attributes["class"]="k-textbox":["button","reset"].indexOf(e.attributes.type)>-1&&(e.attributes["class"]="k-button")),a('<input style="width: 100%;"/>').attr("name",e.field).attr(a.extend({},e.attributes,r.getValueBinding(e.field))).appendTo(d)},textarea:function(b,c){a('<textarea class="k-textbox" style="width: 100%; resize: vertical;"/>').attr("name",c.field).attr(a.extend({},c.attributes,r.getValueBinding(c.field))).appendTo(b)},_template:function(b,d){var e=c.template(d.template);a(e(d)).appendTo(b)}},r={log:function(b){window.app&&window.app.DEBUG&&window.console&&a.isFunction(window.console.log)&&window.console.log("kidoju.widgets.propertygrid: "+b)},hash:function(b){var c={};return a.isArray(b)&&a.each(b,function(a,b){for(var d=b.field.split("."),e=c,f=0;f<d.length;f++)e=e[d[f]]=e[d[f]]||{};e._index=a;for(var g in b)b.hasOwnProperty(g)&&(e[g]=b[g])}),c},formatTitle:function(a){return c.toHyphens(a).replace(/(^\w|-\w)/g,function(a){return a.replace("-"," ").toUpperCase()})},getType:function(c,d,e){var f,g=["string","number","boolean","date"];return c&&g.indexOf(c.type)>-1?c.type:d!==b&&null!==d?(f=a.type(d),g.indexOf(f)>-1?f:b):e!==b&&null!==e?(f=a.type(e),g.indexOf(f)>-1?f:b):h},optimizeEditor:function(d){if(!d.editable)return void(d.editor=q.span);if(!a.isFunction(d.editor)){if(a.type(d.editor)===h){if(d.editor=d.editor.toLowerCase(),d.editor.length&&!m.test(d.editor)&&a.isFunction(q[d.editor]))return void(d.editor=q[d.editor]);var e=["colorpicker","datepicker","datetimepicker","maskedtextbox","multiinput","numerictextbox","rating","slider","switch","timepicker"];if(e.indexOf(d.editor)>-1&&(c.rolesFromNamespaces(c.ui).hasOwnProperty(d.editor)||c.rolesFromNamespaces(c.mobile.ui).hasOwnProperty(d.editor)))return d.attributes=a.extend({},d.attributes,r.getRoleBinding(d.editor)),void(d.editor=q.input)}if(d.editor=b,a.type(d.template)===h&&d.template.length)return void(d.editor=q._template);switch(d.type){case i:d.attributes=a.extend({},d.attributes,r.getRoleBinding("numerictextbox")),d.editor=q.input;break;case j:d.attributes=a.extend({},d.attributes,r.getRoleBinding("switch")),d.editor=q.input;break;case k:d.attributes=a.extend({},d.attributes,r.getRoleBinding("datepicker")),d.editor=q.input;break;default:d.attributes=a.extend({type:"text"},d.attributes),d.editor=q.input}}},getValueBinding:function(b){var d={};return a.type(b)===h&&b.length&&(d[c.attr("bind")]="value: "+b),d},getTextBinding:function(b){var d={};return a.type(b)===h&&b.length&&(d[c.attr("bind")]="text: "+b),d},getRoleBinding:function(b){var d={};return a.type(b)===h&&b.length&&(d[c.attr("role")]=b),d}}}(jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(a,b){"use strict";b()}),function(a,b){"use strict";b(["./vendor/kendo.core","./vendor/kendo.data","./kidoju.data","./kidoju.tools"],a)}(function(){"use strict";return function(a,b){var c=window.kendo,d=c.ui,e=d.Widget,f=window.kidoju,g="string",h="number",i=null,j=".kendoStage",k="mousedown",l="mousemove",m="mouseup",n="touchstart",o="touchmove",p="touchend",q="change",r="dataBinding",s="dataBound",t="propertyBinding",u="propertyBound",v="select",w="move",x="resize",y="rotate",z="absolute",A="relative",B="hidden",C="display",D="block",E="none",F="top",G="left",H="height",I="width",J="cursor",K="transform",L="rotate({0}deg)",M="scale({0})",N=c.attr("uid"),O=c.attr("tool"),P=c.attr("command"),Q='<div class="k-widget kj-stage" />',R="<div "+N+'="{0}" '+O+'="{1}" class="kj-element"></div>',S=".kj-element["+N+'="{0}"]',T=".kj-element",U='<div class="kj-overlay"></div>',V=".kj-overlay",W='<div class="kj-handle-box"></div>',X=".kj-handle-box["+N+'="{0}"]',Y=".kj-handle-box",Z='<span class="kj-handle" '+P+'="move"></span>',$='<span class="kj-handle" '+P+'="resize"></span>',_='<span class="kj-handle" '+P+'="rotate"></span>',ab='<span class="kj-handle" '+P+'="menu"></span>',bb=".kj-handle",cb="state",db={MOVE:"move",RESIZE:"resize",ROTATE:"rotate",MENU:"menu"},eb="pointer",fb="active",gb={MODE:"thumbnail",SCALE:1,WIDTH:1024,HEIGHT:768},hb='<div class="debug-mouse"></div>',ib=".debug-mouse",jb='<div class="debug-bounds"></div>',kb=".debug-bounds",lb='<div class="debug-center"></div>',mb=".debug-center",nb=e.extend({init:function(a,b){var c=this;e.fn.init.call(c,a,b),ob.log("widget initialized"),c.setOptions(b),c._layout(),c._dataSource()},modes:{thumbnail:"thumbnail",design:"design",play:"play"},events:[q,r,s,t,u,v],options:{name:"Stage",autoBind:!0,mode:gb.MODE,scale:gb.SCALE,height:gb.HEIGHT,width:gb.WIDTH,tools:f.tools,dataSource:b},setOptions:function(a){e.fn.setOptions.call(this,a),this._mode=this.options.mode,this._scale=this.options.scale,this._height=this.options.height,this._width=this.options.width},mode:function(c){var d=this;if(c===b)return d._mode;if(a.type(c)!==g)throw new TypeError;if(!d.modes[c])throw new RangeError;c!==d._mode&&(d._mode=c,d._initializeMode())},scale:function(d){var e=this;if(d===b)return e._scale;if(a.type(d)!==h)throw new TypeError;if(0>d)throw new RangeError;d!==e._scale&&(e._scale=d,e.wrapper.css({transformOrigin:"0 0",transform:c.format(M,e._scale)}),e.wrapper.find(bb).css({transform:c.format(M,1/e._scale)}))},height:function(b){var c=this;if(!b)return c._height;if(a.type(b)!==h)throw new TypeError;if(0>b)throw new RangeError;b!==c._height&&(c._height=b)},width:function(b){var c=this;if(!b)return c._width;if(a.type(b)!==h)throw new TypeError;if(0>b)throw new RangeError;b!==c._width&&(c._width=b)},index:function(c){var d,e=this;if(c===b)return d=e.dataSource.getByUid(e._selectedUid),d instanceof f.PageComponent?e.dataSource.indexOf(d):-1;if(a.type(c)!==h||c%1!==0)throw new TypeError;if(0>c||c>0&&c>=e.length())throw new RangeError;d=e.dataSource.at(c),e.value(d)},id:function(c){var d,e=this;if(c!==b){if(a.type(c)!==h&&a.type(c)!==g)throw new TypeError;d=e.dataSource.get(c),e.value(d)}else if(d=e.dataSource.getByUid(e._selectedUid),d instanceof f.PageComponent)return d[d.idField]},value:function(a){var c=this;if(a===i)c._selectedUid!==i&&(c._selectedUid=i,ob.log("selected component uid set to null"),c._toggleSelection(),c.trigger(q,{index:b,value:i}));else{if(a===b)return c._selectedUid===i?i:c.dataSource.getByUid(c._selectedUid);if(!(a instanceof f.PageComponent))throw new TypeError;if(a.uid!==c._selectedUid&&ob.isGuid(a.uid)){var d=c.dataSource.indexOf(a);d>-1&&(c._selectedUid=a.uid,ob.log("selected component uid set to "+a.uid),c._toggleSelection(),c.trigger(q,{index:d,value:a}))}}},length:function(){return this.dataSource instanceof f.PageComponentCollectionDataSource?this.dataSource.total():-1},properties:function(a){var b=this;return a?void(a!==b._properties&&(b._properties=a)):b._properties},setDataSource:function(a){this.options.dataSource=a,this._dataSource()},_dataSource:function(){var b=this;b.dataSource instanceof f.PageComponentCollectionDataSource&&b._refreshHandler&&b.dataSource.unbind(q,b._refreshHandler),b.options.dataSource!==i&&(b.dataSource=f.PageComponentCollectionDataSource.create(b.options.dataSource),b._refreshHandler=a.proxy(b.refresh,b),b.dataSource.bind(q,b._refreshHandler),b.options.autoBind&&b.dataSource.fetch())},_layout:function(){var a=this;a.stage=a.element.wrap(Q).css({position:A,overflow:B,height:a.height(),width:a.width()}),a.wrapper=a.stage.parent().css({position:A,height:a.height(),width:a.width(),transformOrigin:"0 0",transform:c.format(M,a.scale())}),a._initializeMode()},_initializeMode:function(){var a=this;switch(a._clearMode(),a.mode()){case a.modes.thumbnail:a._initializeThumbnailMode();break;case a.modes.design:a._initializeDesignMode();break;case a.modes.play:a._initializePlayMode()}},_clearMode:function(){var b=this;b._destroyContextMenu(),b.wrapper instanceof a&&(b.wrapper.off(j),b.wrapper.find(Y).remove(),b.wrapper.find(V).remove()),b.stage instanceof a&&(b.stage.off(j),a.each(b.stage.find(T),function(a,b){c.unbind(b)})),a.isFunction(b._propertyBinding)&&b.unbind(t,b._propertyBinding)},_addStageElementEventHandlers:function(){var b=this;b.stage.on(w+j,T,a.proxy(b._moveStageElement,b)),b.stage.on(x+j,T,a.proxy(b._resizeStageElement,b)),b.stage.on(y+j,T,a.proxy(b._rotateStageElement,b))},_moveStageElement:function(b,d){var e=this;if(e.options.tools instanceof c.data.ObservableObject){var g=e.options.tools[d.tool];g instanceof f.Tool&&a.isFunction(g.onMove)&&g.onMove(b,d)}},_resizeStageElement:function(b,d){var e=this;if(e.options.tools instanceof c.data.ObservableObject){var g=e.options.tools[d.tool];g instanceof f.Tool&&a.isFunction(g.onResize)&&g.onResize(b,d)}},_rotateStageElement:function(b,d){var e=this;if(e.options.tools instanceof c.data.ObservableObject){var g=e.options.tools[d.tool];g instanceof f.Tool&&a.isFunction(g.onRotate)&&g.onRotate(b,d)}},_initializeThumbnailMode:function(){var b=this;a(U).css({position:z,display:D,top:0,left:0,height:b.height(),width:b.width()}).appendTo(b.wrapper),b._addStageElementEventHandlers()},_initializeDesignMode:function(){var b=this;a(W).css({position:z,display:E}).append(Z).append($).append(_).append(ab).appendTo(b.wrapper),b.wrapper.on(k+j+" "+n+j,a.proxy(b._onMouseDown,b)),b.wrapper.on(l+j+" "+o+j,a.proxy(b._onMouseMove,b)),b.wrapper.on(m+j+" "+p+j,a.proxy(b._onMouseUp,b)),b._addStageElementEventHandlers(),ob.addDebugVisualElements(b.wrapper),b._addContextMenu()},_addContextMenu:function(){var b=this;b.menu=a('<ul class="kj-stage-menu"></ul>').append("<li "+P+'="lock">Lock</li>').append("<li "+P+'="delete">Delete</li>').appendTo(b.wrapper).kendoContextMenu({target:".kj-handle["+P+'="menu"]',showOn:k+" "+n,select:a.proxy(b._contextMenuSelectHandler,b)}).data("kendoContextMenu")},_destroyContextMenu:function(){var a=this;a.menu instanceof c.ui.ContextMenu&&(a.menu.destroy(),a.menu.element.remove(),delete a.menu)},_contextMenuSelectHandler:function(b){var c=this;switch(a(b.item).attr(P)){case"lock":break;case"delete":var d=c.wrapper.find(Y).attr(N),e=c.dataSource.getByUid(d);c.dataSource.remove(e)}},_initializePlayMode:function(){var b=this;b._addStageElementEventHandlers(),a.isFunction(b._propertyBinding)&&b.unbind(t,b._propertyBinding),b._propertyBinding=a.proxy(function(){var b=this;b.properties()instanceof c.data.ObservableObject&&a.each(b.stage.find(T),function(a,d){c.bind(d,b.properties())})},b),b.bind(t,b._propertyBinding)},_addStageElement:function(b,d,e){var g=this;if(b instanceof f.PageComponent&&0===g.stage.find(c.format(S,b.uid)).length){a.type(d)===h&&a.type(e)===h&&(b.set(G,d),b.set(F,e));var i=g.options.tools[b.tool];if(i instanceof f.Tool){var j=a(c.format(R,b.uid,b.tool)).css({position:z,top:b.get(F),left:b.get(G),height:b.get(H),width:b.get(I),transform:c.format(L,b.get(y))});j.append(i.getHtml(b)),g.stage.append(j),g._moveStageElement({currentTarget:j,preventDefault:a.noop,stopPropagation:a.noop},b),g._resizeStageElement({currentTarget:j,preventDefault:a.noop,stopPropagation:a.noop},b),g._rotateStageElement({currentTarget:j,preventDefault:a.noop,stopPropagation:a.noop},b)
}}},_removeStageElementByUid:function(a){var b=this.stage.find(c.format(S,a));c.unbind(b),b.off(j).remove()},_showHandles:function(a){var b=this,d=b.wrapper.find(Y);if(d.length){var e=b.stage.find(c.format(S,a));d.css({top:e.css(F),left:e.css(G),height:e.css(H),width:e.css(I),transform:e.css(K),display:D}).attr(N,a),d.find(bb).css({transform:c.format(L,-ob.getTransformRotation(e))+" "+c.format(M,1/b.scale())})}},_hideHandles:function(){this.wrapper.find(Y).css({display:E}).removeAttr(N)},_onMouseDown:function(b){var d,e=this,g=e.options.tools.get(fb),h=a(b.target),j=ob.getMousePosition(b),k=h.closest(T),l=h.closest(bb);if(e.menu instanceof c.ui.ContextMenu&&e.menu.close(),g!==eb){var m=e.options.tools[g];if(m instanceof f.Tool){var n=new f.PageComponent({tool:m.id,left:j.x,top:j.y,width:m.width,height:m.height});e.dataSource.add(n)}e.options.tools.set(fb,eb)}else if(l.length){var o=l.attr(P);if(o===db.MENU)a.noop();else{var p=e.wrapper.find(Y);d=p.attr(N),k=e.stage.find(c.format(S,d)),p.data(cb,{command:o,top:parseFloat(k.css(F))||0,left:parseFloat(k.css(G))||0,height:k.height(),width:k.width(),angle:ob.getTransformRotation(k),scale:ob.getTransformScale(e.wrapper),snapGrid:0,snapAngle:0,mouseX:j.x,mouseY:j.y,uid:d}),a(document.body).css(J,h.css(J))}}else if(k.length||h.is(Y)){if(d=k.attr(N),ob.isGuid(d)){var q=e.dataSource.getByUid(d);q instanceof f.PageComponent&&e.value(q)}}else e.value(i);b.preventDefault(),b.stopPropagation()},_onMouseMove:function(b){var d=this,e=d.wrapper.find(Y),f=e.data(cb);if(a.isPlainObject(f)){var g=ob.getMousePosition(b),h=d.stage.find(c.format(S,f.uid)),i=d.options.dataSource.getByUid(f.uid),j=h[0].getBoundingClientRect(),k={left:j.left-d.stage.offset().left+a(document.body).scrollLeft(),top:j.top-d.stage.offset().top+a(document.body).scrollTop(),height:j.height,width:j.width},l={x:k.left+k.width/2,y:k.top+k.height/2};if(ob.updateDebugVisualElements({wrapper:d.wrapper,mouse:g,center:l,bounds:k,scale:f.scale}),f.command===db.MOVE)i.set(G,ob.snap(f.left+(g.x-f.mouseX)/f.scale,f.snapGrid)),i.set(F,ob.snap(f.top+(g.y-f.mouseY)/f.scale,f.snapGrid));else if(f.command===db.RESIZE){var m=(g.x-f.mouseX)/f.scale,n=(g.y-f.mouseY)/f.scale,o={x:l.x+m/2,y:l.y+n/2},p={x:f.left,y:f.top},q=ob.deg2rad(f.angle),r=ob.getRotatedPoint(p,l,q),s=ob.getRotatedPoint(r,o,-q);i.set(G,s.x),i.set(F,s.y),i.set(H,ob.snap(f.height-m*Math.sin(q)+n*Math.cos(q),f.snapGrid)),i.set(I,ob.snap(f.width+m*Math.cos(q)+n*Math.sin(q),f.snapGrid))}else if(f.command===db.ROTATE){var t=ob.getRadiansBetween2Points(l,{x:f.mouseX,y:f.mouseY},g),u=ob.snap((360+f.angle+ob.rad2deg(t))%360,f.snapAngle);i.set(y,u)}b.preventDefault(),b.stopPropagation()}},_onMouseUp:function(){var b=this,c=b.wrapper.find(Y),d=c.data(cb);a.isPlainObject(d)&&(c.removeData(cb),a(document.body).css(J,""),ob.hideDebugVisualElements(b.wrapper))},refresh:function(d){var e=this;if(d===b||d.action===b){var g=[];d===b&&e.dataSource instanceof c.data.PageComponentCollectionDataSource?g=e.dataSource.data():d&&d.items instanceof c.data.ObservableArray&&(g=d.items),e._hideHandles(),e.trigger(r),a.each(e.stage.find(T),function(b,c){e._removeStageElementByUid(a(c).attr(N))}),a.each(g,function(a,b){e._addStageElement(b)}),e.trigger(s),e.trigger(t),e.trigger(u)}else"add"===d.action?a.each(d.items,function(a,b){e._addStageElement(b),e.value(b)}):"remove"===d.action?a.each(d.items,function(a,b){e._removeStageElementByUid(b.uid),e.trigger(q,{action:d.action,value:b}),e.wrapper.find(Y).attr(N)===b.uid&&e.value(i)}):"itemchange"===d.action&&a.each(d.items,function(b,g){var h=e.stage.find(c.format(S,g.uid)),i=e.wrapper.find(c.format(X,g.uid));if(h.length)switch(d.field){case G:h.css(G,g.left),i.css(G,g.left),h.trigger(w+j,g);break;case F:h.css(F,g.top),i.css(F,g.top),h.trigger(w+j,g);break;case H:h.css(H,g.height),i.css(H,g.height),h.trigger(x+j,g);break;case I:h.css(I,g.width),i.css(I,g.width),h.trigger(x+j,g);break;case y:h.css(K,c.format(L,g.rotate)),i.css(K,c.format(L,g.rotate)),i.find(bb).css(K,c.format(L,-g.rotate)+" "+c.format(M,1/e.scale())),h.trigger(y+j,g);break;default:if(/^attributes/.test(d.field)||/^properties/.test(d.field)){var k=f.tools[g.tool];k instanceof f.Tool&&(h.html(k.getHtml(g)),e._moveStageElement({currentTarget:h,preventDefault:a.noop,stopPropagation:a.noop},g),e._resizeStageElement({currentTarget:h,preventDefault:a.noop,stopPropagation:a.noop},g),e._rotateStageElement({currentTarget:h,preventDefault:a.noop,stopPropagation:a.noop},g))}}})},_toggleSelection:function(){var a=this,b=a._selectedUid,d=a.wrapper.find(Y);if(d.length){var e=a.stage.find(c.format(S,b));ob.isGuid(b)&&e.length&&d.attr(N)!==b?a._showHandles(b):b===i&&d.css(C)!==E&&a._hideHandles()}},items:function(){return this.element[0].children},_clear:function(){var a=this;a._clearMode(),c.unbind(a.element),a.element.find("*").off(),a.element.off().empty().unwrap()},destroy:function(){var a=this;e.fn.destroy.call(a),a._clear(),a.setDataSource(i),c.destroy(a.element)}});c.ui.plugin(nb);var ob={log:function(b){window.app&&window.app.DEBUG&&window.console&&a.isFunction(window.console.log)&&window.console.log("kidoju.widgets.stage: "+b)},isGuid:function(b){return a.type(b)===g&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(b)},deg2rad:function(a){return a*Math.PI/180},rad2deg:function(a){return 180*a/Math.PI},snap:function(a,b){return b?b/2>a%b?a-a%b:a+b-a%b:a},getTransformRotation:function(b){var c=(a(b).attr("style")||"").match(/rotate\([\s]*([0-9\.]+)[deg\s]*\)/);return a.isArray(c)&&c.length>1?parseFloat(c[1])||0:0},getTransformScale:function(b){var c=(a(b).attr("style")||"").match(/scale\([\s]*([0-9\.]+)[\s]*\)/);return a.isArray(c)&&c.length>1?parseFloat(c[1])||1:1},getMousePosition:function(b){var d=b.originalEvent&&b.originalEvent.touches?b.originalEvent.touches[0].clientX:b.clientX,e=b.originalEvent&&b.originalEvent.touches?b.originalEvent.touches[0].clientY:b.clientY,f=a(b.currentTarget).find(c.roleSelector("stage")),g={x:d-f.offset().left+a(document.body).scrollLeft(),y:e-f.offset().top+a(document.body).scrollTop()};return g},getRotatedPoint:function(b,c,d){return a.isPlainObject(b)&&"number"===a.type(b.x)&&"number"===a.type(b.y)&&a.isPlainObject(c)&&"number"===a.type(c.x)&&"number"===a.type(c.y)&&"number"===a.type(d)?{x:c.x+(b.x-c.x)*Math.cos(d)-(b.y-c.y)*Math.sin(d),y:c.y+(b.x-c.x)*Math.sin(d)+(b.y-c.y)*Math.cos(d)}:void 0},getRadiansBetween2Points:function(b,c,d){return a.isPlainObject(b)&&"number"===a.type(b.x)&&"number"===a.type(b.y)&&a.isPlainObject(c)&&"number"===a.type(c.x)&&"number"===a.type(c.y)&&a.isPlainObject(d)&&"number"===a.type(d.x)&&"number"===a.type(d.y)?Math.atan2(d.y-b.y,d.x-b.x)-Math.atan2(c.y-b.y,c.x-b.x):void 0},addDebugVisualElements:function(b){window.app&&window.app.DEBUG&&(a(jb).css({position:z,border:"1px dashed #FF00FF",display:E}).appendTo(b),a(lb).css({position:z,height:"20px",width:"20px",marginTop:"-10px",marginLeft:"-10px",borderRadius:"50%",backgroundColor:"#FF00FF",display:E}).appendTo(b),a(hb).css({position:z,height:"20px",width:"20px",marginTop:"-10px",marginLeft:"-10px",borderRadius:"50%",backgroundColor:"#00FFFF",display:E}).appendTo(b))},updateDebugVisualElements:function(b){window.app&&window.app.DEBUG&&a.isPlainObject(b)&&b.scale>0&&(b.wrapper.find(mb).css({display:"block",left:b.center.x/b.scale,top:b.center.y/b.scale}),b.wrapper.find(kb).css({display:"block",left:b.bounds.left/b.scale,top:b.bounds.top/b.scale,height:b.bounds.height/b.scale,width:b.bounds.width/b.scale}),b.wrapper.find(ib).css({display:"block",left:b.mouse.x/b.scale,top:b.mouse.y/b.scale}))},hideDebugVisualElements:function(a){window.app&&window.app.DEBUG&&(a.find(mb).css({display:E}),a.find(kb).css({display:E}),a.find(ib).css({display:E}))}}}(jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(a,b){"use strict";b()}),function(a,b){"use strict";b(["./vendor/kendo.core","./vendor/kendo.data","./kidoju.tools","./kidoju.data","./kidoju.tools"],a)}(function(){"use strict";return function(a,b){function c(b){window.app&&window.app.DEBUG&&window.console&&a.isFunction(window.console.log)&&window.console.log("kidoju.widgets.toolbox: "+b)}var d=window.kendo,e=d.ui.Widget,f=window.kidoju,g="string",h="click",i="change",j="k-widget kj-toolbox",k='<img src="{0}" alt="{1}">',l="kj-tool",m="data-tool",n="data-selected",o="active",p="pointer",q=32,r=e.extend({init:function(a,b){var d=this;b=b||{},e.fn.init.call(d,a,b),c("widget initialized"),d._layout()},options:{name:"Toolbox",size:q,iconPath:"./styles/images/",tools:f.tools},events:[h,i],tool:function(e){var f=this;if(e===b)return a(f.element).find("["+n+"]").attr(m);if(a.type(e)!==g)throw new TypeError("A tool id should be a string");if(!f.options.tools.hasOwnProperty(e))throw new RangeError(d.format("{0} is not the id of a known tool",e));e!==f.options.tools.get(o)&&(f.options.tools.set(o,e),c("tool changed for "+e),f.trigger(i,{value:e}))},reset:function(){this.tool(p)},_layout:function(){var b=this;a(b.element).addClass(j),a.each(b.options.tools,function(c,e){if(e instanceof f.Tool&&b.options.tools.hasOwnProperty(e.id)){var g=a(d.format(k,b.options.iconPath+e.icon+".svg","TODO: Translate")).attr(m,e.id).addClass(l).height(b.options.size).width(b.options.size);a(b.element).append(g)}}),a(b.element).find("img").on(h,function(c){var d=a(c.target).attr(m);b.trigger(h,{value:d}),a.type(d)===g&&b.options.tools.hasOwnProperty(d)&&b.tool(d)}),b.refresh(),a.isFunction(b._refreshHandler)&&b.options.tools.unbind(i,b._refreshHandler),b._refreshHandler=a.proxy(b.refresh,b),b.options.tools.bind(i,b._refreshHandler)},refresh:function(){var b=this;a(b.element).find("["+n+"]").removeAttr(n),a(b.element).find("["+m+"="+b.options.tools.get(o)+"]").attr(n,!0)},_clear:function(){var b=this;a(b.element).find("*").off(),a(b.element).off(),a(b.element).empty(),a(b.element).removeClass(j)},destroy:function(){var b=this;e.fn.destroy.call(b),b._clear(),a.isFunction(b._refreshHandler)&&b.options.tools.unbind(i,b._refreshHandler),d.destroy(b.element)}});d.ui.plugin(r)}(jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(a,b){"use strict";b()});
//# sourceMappingURL=kidoju.widgets.min.map